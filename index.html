<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Note: Security headers are configured via HTTP headers in _headers file:
         - Content-Security-Policy
         - X-Frame-Options: DENY
         - X-Content-Type-Options: nosniff
         - Strict-Transport-Security (HSTS)
         - Permissions-Policy
         For Apache/Nginx deployments, see templates in /configs/ directory -->
    
    <title>SEB Konfigurations-Generator</title>
    <link rel="stylesheet" href="css/app.css">
    
    <!-- Load template data as JavaScript (works offline!) -->
    <script src="templates/generated/xml-data.js"></script>
    <script src="templates/generated/seb-options-windows.js"></script>
    <script src="templates/generated/seb-options-macos.js"></script>
    <script src="templates/generated/seb-options-ipados.js"></script>
    <script src="templates/generated/wikipedia-mapping.js"></script>
    <script src="templates/generated/seb-option-labels.js"></script>
</head>
<body>
    <!-- Dev Version Banner -->
    <div class="dev-banner hidden">
        <div class="dev-banner-left">üöß Latest Dev Version</div>
        <div class="dev-banner-right">
            <div class="dev-banner-item">
                <span class="dev-banner-label">Version:</span>
                <span class="dev-banner-value" id="devVersion">‚Äî</span>
            </div>
            <div class="dev-banner-item">
                <span class="dev-banner-label">Commit:</span>
                <span class="dev-banner-value" id="devCommit">‚Äî</span>
            </div>
            <div class="dev-banner-item">
                <span class="dev-banner-label">Build:</span>
                <span class="dev-banner-value" id="devBuild">‚Äî</span>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="lang-btn active" data-lang="de">Deutsch</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
            <h1>üõ°Ô∏è <span data-i18n="title">SEB Konfigurations-Generator</span></h1>
            <p data-i18n="subtitle">Erstellen Sie Safe Exam Browser Konfigurationen f√ºr Fokus-Modus im Unterricht</p>
            <p class="header-doc-link">
                <a href="#" id="mainDocLink" class="doc-link" target="_blank" rel="noopener noreferrer">
                    üìö <span data-i18n="mainDocLink">Vollst√§ndige Anleitung</span>
                </a>
            </p>
            <div class="privacy-notice">
                <strong>üîí <span data-i18n="privacyTitle">Datenschutz:</span></strong> <span data-i18n="privacyText">Alle Daten werden ausschliesslich lokal in Ihrem Browser verarbeitet. Es werden keine Konfigurationsdaten oder Eingaben an unseren Server gesendet oder gespeichert. Nur Ihre Sprachpr√§ferenz wird lokal im Browser gespeichert.</span>
            </div>
            <p class="suggest-service">
                <a href="https://github.com/markuskiller/SEBConfigGenerator/issues/new" target="_blank" rel="noopener noreferrer">
                    üí° <span data-i18n="suggestService">Dienst oder Hilfsmittel vorschlagen</span>
                </a>
            </p>
        </div>
        <div class="content">
            <div class="section">
                <h2><span data-i18n="step1">1. Dienst ausw√§hlen</span></h2>
                <div class="preset-buttons" id="presetButtons"></div>
            </div>
            <div class="section">
                <h2><span data-i18n="step2">2. Konfigurationseinstellungen</span></h2>
                <div class="form-group">
                    <label for="startUrl" data-i18n="startUrl">Start-URL</label>
                    <div id="startUrlSelectorContainer" class="start-url-selector-container dropdown-container single-choice">
                        <button type="button" id="startUrlDropdownBtn" class="dropdown-btn">
                            <span data-i18n="selectStartUrl">Start-URL w√§hlen</span>
                        </button>
                        <div id="startUrlDropdownMenu" class="dropdown-menu hidden">
                            <!-- Options will be populated dynamically -->
                        </div>
                    </div>
                    <input type="url" id="startUrl" placeholder="https://sites.google.com/view/your-secret-page-xyz123">
                </div>
                <div class="form-group">
                    <label for="configName" data-i18n="configName">Konfigurationsname</label>
                    <input type="text" id="configName" placeholder="FocusMode-2025-11-18_13-50">
                </div>
                
                <!-- SharePoint Link Configuration (shown only for OneNote/Word) -->
                <div class="form-group sharepoint-options-container hidden" id="sharepointLinkGroup">
                    <label for="sharepointLink" data-i18n="sharepointLinkLabel">SharePoint-Link (Optional - f√ºr erweiterte Filterung)</label>
                    <input type="url" id="sharepointLink" data-i18n-placeholder="sharepointLinkPlaceholder" placeholder="https://schule.sharepoint.com/sites/...">
                    <div class="info-box" id="sharepointBestPractice">
                        <span data-i18n="sharepointLinkBestPractice">üí° Die besten Ergebnisse werden mit direkten Links zu einer OneNote-Seite / einem OneNote-Abschnitt erreicht, wenn der Link aus der OneNote-Desktop-App (Rechtsklick auf Abschnitt oder Seite) eingef√ºgt wird. Hinweis: Einschr√§nkungen auf Abschnitts- oder Seitenebene sind nur sinnvoll, wenn kein Schreibzugriff erforderlich ist (reine Lese-/Recherche-Aufgaben) oder wenn der Link auf einen kollaborativen Bereich zeigt. F√ºr die meisten Anwendungsf√§lle ist Einschr√§nkung auf OneNote-Notizbuch ausreichend.</span>
                    </div>
                    <div id="sharepointHelp" class="sharepoint-help hidden">
                        <!-- Help text will be inserted here dynamically -->
                    </div>
                    <div id="sharepointOptions" class="sharepoint-options-container hidden">
                        <!-- SharePoint options will be rendered here dynamically -->
                    </div>
                </div>
                
                <!-- Additional Options (Static Checkboxes) -->
                <div class="form-group">
                    <div class="form-group-label" data-i18n="additionalOptions">Zus√§tzliche Optionen</div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowDownloads" checked>
                        <label for="allowDownloads" data-i18n="allowDownloads">Datei-Downloads erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowSpellCheck">
                        <label for="allowSpellCheck" data-i18n="allowSpellCheck">Rechtschreibpr√ºfung erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showReloadButton" checked>
                        <label for="showReloadButton" data-i18n="showReloadButton">Neu-Laden-Button anzeigen</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowBackForward">
                        <label for="allowBackForward" data-i18n="allowBackForward">Vor/Zur√ºck-Navigation erlauben</label>
                    </div>
                </div>
                
                <!-- My Favorites (Dynamic Tiles) -->
                <div id="myFavoritesContainer" class="form-group">
                    <!-- Favorites tiles will be rendered here dynamically -->
                </div>
            </div>
            <div class="section">
                <h2>
                    <span data-i18n="step3">3. Benutzerdefinierte Domains (Optional)</span>
                    <a href="#" id="advancedURLFilterLink" class="advanced-url-filter-link" title="Zu erweiterten URL-Einstellungen">
                        üîó <span data-i18n="advancedURLFilterLinkText">URL-Einstellungen f√ºr Fortgeschrittene</span>
                    </a>
                </h2>
                <div class="form-group">
                    <label for="customDomains" data-i18n="customDomainsLabel">Zus√§tzliche erlaubte Domains hinzuf√ºgen (eine pro Zeile)</label>
                    <textarea id="customDomains" data-i18n-placeholder="customDomainsPlaceholder" placeholder="beispiel.de&#10;*.schule-domain.de"></textarea>
                </div>
                <div class="form-group">
                    <label for="blockedDomains" data-i18n="blockedDomainsLabel">Zus√§tzlich zu sperrende Domains (Optional, eine pro Zeile)</label>
                    <textarea id="blockedDomains" data-i18n-placeholder="blockedDomainsPlaceholder" placeholder="facebook.com&#10;instagram.com&#10;tiktok.com"></textarea>
                </div>
                <div class="info-box">
                    <h4 data-i18n="proTipTitle">üí° Profi-Tipp</h4>
                    <p data-i18n="proTipText">Verwenden Sie Wildcards (*) um alle Subdomains zu erlauben. Zum Beispiel: <code>*.microsoft.com</code> erlaubt login.microsoft.com, account.microsoft.com, usw.<br><br><strong>Hinweis:</strong> Doppelte Domains werden automatisch entfernt.</p>
                </div>
            </div>
            
            <!-- Advanced Section (Collapsible) -->
            <div class="advanced-section">
                <div class="advanced-header" id="advancedHeader">
                    <h2>‚öôÔ∏è <span data-i18n="advancedSettings">Erweiterte Einstellungen</span></h2>
                    <span class="advanced-toggle">‚ñº</span>
                </div>
                <div class="advanced-content" id="advancedContent">
                    <div class="advanced-content-inner">
                        <!-- Boolean Options (All True/False Options from XML) -->
                        <div class="section">
                            <h2><span data-i18n="allBooleanOptions">Erweiterte Optionen (f√ºr fortgeschrittene Anwender)</span></h2>
                            
                            <!-- URL Filter Rules (TOP PRIORITY - after title) -->
                            <div id="urlFilterPlaceholder"></div>
                            
                            <!-- Platform Selection for Boolean Options -->
                            <div class="platform-selector">
                                <span class="platform-selector-label">
                                    <span data-i18n="platformReference">üìö Men√º-Referenz f√ºr:</span>
                                </span>
                                <div class="platform-buttons">
                                    <button class="platform-btn" data-platform="windows">
                                        üñ•Ô∏è Windows
                                    </button>
                                    <button class="platform-btn" data-platform="macos">
                                        üçé macOS
                                    </button>
                                    <button class="platform-btn" data-platform="ipados">
                                        üì± iPadOS
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Experimental Warning -->
                            <div class="boolean-warning">
                                <strong>‚ö†Ô∏è <span data-i18n="experimentalFeature">Experimentelle Funktion</span></strong><br>
                                <span data-i18n="booleanOptionsWarning">
                                    Diese Funktion befindet sich in Entwicklung. Die Men√º-Referenzen werden schrittweise f√ºr alle Plattformen erg√§nzt. Verwenden Sie diese Optionen mit Vorsicht und testen Sie die generierte Konfiguration gr√ºndlich.
                                </span>
                            </div>
                            
                            <!-- Global Search for all Boolean Options & Process Lists -->
                            <div id="globalSearchContainer" class="global-search-container hidden">
                                <div class="search-input-wrapper">
                                    <input type="text" 
                                           id="globalSearch" 
                                           class="global-search-input" 
                                           placeholder="üîç Search all settings and processes..."
                                           autocomplete="on"
                                           name="global-search">
                                    <button class="search-clear-btn hidden" id="globalSearchClear" title="Clear search">‚úï</button>
                                </div>
                                <span class="global-search-count" id="globalSearchCount"></span>
                            </div>
                            
                            <div id="booleanOptionsContainer"></div>
                            
                            <!-- Dict Structures (Process Lists, Certificates, etc.) -->
                            <div id="dictStructuresContainer"></div>
                        </div>
                        
                        <!-- Security Level -->
                        <div class="section">
                            <h2><span data-i18n="securityLevel">Sicherheitsstufe</span></h2>
                            <div class="security-level" id="securityLevel"></div>
                            
                            <!-- Security Level Affected Options (collapsible) -->
                            <div id="securityLevelDetailsContainer" class="bool-group-container security-level-details"></div>
                        </div>
                        
                        <!-- Preview & Download -->
                        <div class="section">
                            <h2><span data-i18n="previewAndDownload">Vorschau</span></h2>
                            <div class="preview">
                                <h3><span data-i18n="allowedDomains">Erlaubte Domains</span> <span class="badge" id="domainCount">0</span></h3>
                                <div class="domain-list" id="domainPreview"></div>
                            </div>
                            <div class="actions">
                                <button class="btn btn-secondary" id="copyBtn">
                                    <span data-i18n="copyBtn">üìã Domain-Liste kopieren</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Network Capture Helper -->
                        <div class="section">
                            <div class="info-box" id="networkCaptureHelper">
                                <h4>üîß <span data-i18n="helperScriptTitle">Network Capture Helper</span></h4>
                                <p data-i18n="helperScriptText">
                                    Ben√∂tigen Sie Hilfe beim Erfassen von Netzwerk-Domains? W√§hlen Sie die passende Methode f√ºr Ihr System:
                                </p>
                                <div class="helper-buttons">
                                    <a href="scripts/capture-helper.ps1" download target="_blank" class="btn btn-secondary">
                                        <span data-i18n="downloadHelperBtn">‚¨áÔ∏è PowerShell (Windows)</span>
                                    </a>
                                    <button class="btn btn-secondary" id="browserHelperBtn">
                                        <span data-i18n="browserHelperBtn">üåê Browser-Methode (Alle OS)</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Help Links -->
                        <div class="section">
                            <div class="help-section">
                                <h4>üìñ <span data-i18n="advancedHelpTitle">Erweiterte Hilfe</span></h4>
                                <div class="help-links">
                                    <a href="#" id="browserCaptureLink" class="doc-link" target="_blank" rel="noopener noreferrer">
                                        üåê <span data-i18n="browserCaptureLink">Browser Capture</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><span data-i18n="step4">4. Download</span></h2>
                <!-- Export Format Selection -->
                <div class="export-format-section">
                    <h4 data-i18n="exportFormatTitle">üì• Export-Format</h4>
                    <div class="export-format-options">
                        <label class="export-format-option">
                            <input type="radio" name="exportFormat" value="seb" checked>
                            <span>
                                <strong data-i18n="exportFormatSeb">.seb Datei (Desktop/Laptop)</strong>
                                <small data-i18n="exportFormatSebDesc">F√ºr SEB Config Tool</small>
                            </span>
                        </label>
                        <label class="export-format-option">
                            <input type="radio" name="exportFormat" value="moodle">
                            <span>
                                <strong data-i18n="exportFormatMoodle">Moodle Quiz-Einstellungen</strong>
                                <small data-i18n="exportFormatMoodleDesc">Zum Kopieren in Moodle</small>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-primary btn-full-width" id="generateBtn">
                        <span data-i18n="downloadBtn">üì• SEB Konfiguration herunterladen (.seb)</span>
                    </button>
                    <button class="btn btn-primary btn-full-width" id="generateMoodleBtn">
                        <span data-i18n="generateMoodleBtn">üìã Moodle-Konfiguration anzeigen</span>
                    </button>
                </div>
                
                <!-- Critical Warning Box (only for .seb export) -->
                <div id="sebWarningBox" class="warning-box-critical">
                    <div class="warning-box-critical-icon">‚ö†Ô∏è</div>
                    <div class="warning-box-critical-content">
                        <strong data-i18n="criticalWarningTitle">Wichtiger Hinweis:</strong>
                        <span data-i18n="criticalWarningText">Die heruntergeladene .seb-Datei ist nur eine Vorlage! Die unten beschriebenen 'N√§chsten Schritte' m√ºssen zwingend ausgef√ºhrt werden, bevor die Konfiguration produktiv im Unterricht eingesetzt und an die Sch√ºlerinnen und Sch√ºler verteilt werden kann.</span>
                    </div>
                </div>
                
                <div id="nextStepsBox" class="info-box">
                    <h4 data-i18n="nextStepsTitle">N√§chste Schritte</h4>
                    <p data-i18n="nextStepsText">
                        1. SEB-Konfigurationsdatei herunterladen (.seb)<br>
                        2. Im SEB Config Tool √∂ffnen<br>
                        3. Einstellungen verfeinern und verschl√ºsseln<br>
                        4. Als finale .seb-Datei speichern<br>
                        5. Verschl√ºsselte Datei an Sch√ºler*innen verteilen
                    </p>
                </div>
                
                <!-- Help Links - Basic Section -->
                <div class="help-section help-section-spaced">
                    <h4>üìñ <span data-i18n="helperDocsTitle">Hilfe & Anleitungen</span></h4>
                    <div class="help-links">
                        <a href="#" id="quickstartLinkBasic" class="doc-link" target="_blank" rel="noopener noreferrer">
                            üöÄ <span data-i18n="quickstartLink">Schnellstart (Google Sites)</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-version">
            <span id="versionInfo"></span>
        </div>
    </div>

    <!-- Moodle Configuration Modal -->
    <div id="moodleModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="moodleModalTitle">Moodle Quiz-Konfiguration</h2>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <p data-i18n="moodleModalIntro">Kopieren Sie die folgenden Werte in die entsprechenden Felder in Ihren Moodle Quiz-Einstellungen (Abschnitt "Safe Exam Browser"):</p>
                
                <div class="alert alert-warning">
                    <p data-i18n="moodleUrlFilterWarning">‚ö†Ô∏è Wichtig: In der Moodle Quiz-Konfiguration muss 'URL-Filter erlauben' auf 'Ja' gesetzt sein, damit die URL-Felder sichtbar werden.</p>
                </div>
                
                <!-- Expressions Allowed -->
                <details class="moodle-section" open>
                    <summary><strong data-i18n="moodleExpressionsAllowed">Expressions allowed</strong></summary>
                    <div class="moodle-field">
                        <label for="moodleExpressionsAllowed" class="visually-hidden" data-i18n="moodleExpressionsAllowed">Expressions allowed</label>
                        <textarea id="moodleExpressionsAllowed" readonly></textarea>
                        <button class="btn btn-copy" data-field="moodleExpressionsAllowed">
                            üìã <span data-i18n="copyBtn">Kopieren</span>
                        </button>
                    </div>
                </details>

                <!-- Regex Allowed -->
                <details class="moodle-section" id="moodleRegexAllowedSection">
                    <summary><strong data-i18n="moodleRegexAllowed">Regex allowed</strong> <span class="moodle-hint" data-i18n="moodleRegexHint">(meist leer)</span></summary>
                    <div class="moodle-field">
                        <p class="moodle-example-note" data-i18n="moodleRegexExampleNote">‚ö†Ô∏è Beispiel (nicht kopieren): F√ºr spezifische URL-Muster wie Moodle-Ressourcen</p>
                        <label for="moodleRegexAllowed" class="visually-hidden" data-i18n="moodleRegexAllowed">Regex allowed</label>
                        <textarea id="moodleRegexAllowed" readonly class="moodle-example">^https://moodle\.example\.com/mod/resource/view\.php\?id=\d+$</textarea>
                        <button class="btn btn-copy moodle-copy-regex hidden" data-field="moodleRegexAllowed">
                            üìã <span data-i18n="copyBtn">Kopieren</span>
                        </button>
                    </div>
                </details>

                <!-- Expressions Blocked -->
                <details class="moodle-section" id="moodleExpressionsBlockedSection">
                    <summary><strong data-i18n="moodleExpressionsBlocked">Blockierte Ausdr√ºcke</strong></summary>
                    <div class="moodle-field">
                        <label for="moodleExpressionsBlocked" class="visually-hidden" data-i18n="moodleExpressionsBlocked">Blockierte Ausdr√ºcke</label>
                        <textarea id="moodleExpressionsBlocked" readonly></textarea>
                        <button class="btn btn-copy" data-field="moodleExpressionsBlocked">
                            üìã <span data-i18n="copyBtn">Kopieren</span>
                        </button>
                    </div>
                </details>

                <!-- Regex Blocked -->
                <details class="moodle-section" id="moodleRegexBlockedSection">
                    <summary><strong data-i18n="moodleRegexBlocked">Regex blocked</strong> <span class="moodle-hint" data-i18n="moodleRegexHint">(meist leer)</span></summary>
                    <div class="moodle-field">
                        <p class="moodle-example-note" data-i18n="moodleRegexExampleNote">‚ö†Ô∏è Beispiel (nicht kopieren): Zum Blockieren spezifischer URL-Muster</p>
                        <label for="moodleRegexBlocked" class="visually-hidden" data-i18n="moodleRegexBlocked">Regex blocked</label>
                        <textarea id="moodleRegexBlocked" readonly class="moodle-example">^https://.*\.(facebook|twitter|instagram)\.com/.*$</textarea>
                        <button class="btn btn-copy moodle-copy-regex hidden" data-field="moodleRegexBlocked">
                            üìã <span data-i18n="copyBtn">Kopieren</span>
                        </button>
                    </div>
                </details>

                <!-- Download Option -->
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="downloadMoodleTxt">
                        üíæ <span data-i18n="downloadMoodleTxt">Als TXT herunterladen</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generated Templates (loaded before app.js) -->
    <script src="templates/generated/translations.js"></script>
    <script src="templates/generated/presets.js"></script>
    <script src="templates/generated/preset-groups.js"></script>
    <script src="templates/generated/subjects.js"></script>
    <script src="templates/generated/security-levels.js"></script>
    <script src="templates/generated/browser-capture.js"></script>
    
    <!-- DOM URL Filter Management (Single Source of Truth) -->
    <script src="js/dom-url-filter.js"></script>
    
    <!-- Main Application Script -->
    <script src="js/app.js"></script>
</body>
</html>
