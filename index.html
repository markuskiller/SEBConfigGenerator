<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEB Konfigurations-Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%); color: white; padding: 40px 30px; text-align: center; position: relative; }
        .language-toggle { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .lang-btn { background: rgba(255,255,255,0.2); border: 2px solid white; color: white; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .lang-btn:hover { background: rgba(255,255,255,0.3); }
        .lang-btn.active { background: white; color: #5e72e4; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .content { padding: 40px 30px; }
        .section { margin-bottom: 40px; }
        .section h2 { color: #5e72e4; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e9ecef; }
        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 600; color: #32325d; margin-bottom: 8px; }
        input[type="text"], input[type="url"], textarea, select { width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 6px; font-size: 14px; transition: border-color 0.3s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #5e72e4; }
        textarea { min-height: 150px; font-family: 'Courier New', monospace; resize: vertical; }
        .preset-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .preset-btn { padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; cursor: pointer; transition: all 0.3s; text-align: left; }
        .preset-btn:hover { border-color: #5e72e4; background: #f7f8fc; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(94,114,228,0.15); }
        .preset-btn.active { border-color: #5e72e4; background: #f0f3ff; }
        .preset-btn h3 { color: #5e72e4; margin-bottom: 5px; font-size: 1.1em; }
        .preset-btn p { color: #8898aa; font-size: 0.9em; }
        .checkbox-group { display: flex; align-items: center; margin-bottom: 15px; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; margin-right: 10px; cursor: pointer; }
        .security-level { display: flex; gap: 15px; margin-top: 15px; }
        .security-option { flex: 1; padding: 20px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .security-option:hover { border-color: #5e72e4; }
        .security-option.active { border-color: #5e72e4; background: #f0f3ff; }
        .security-option h4 { color: #5e72e4; margin-bottom: 8px; }
        .security-option p { color: #8898aa; font-size: 0.9em; }
        .btn { padding: 15px 30px; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(94,114,228,0.3); }
        .btn-secondary { background: #f7f8fc; color: #5e72e4; border: 2px solid #e9ecef; }
        .btn-secondary:hover { background: #e9ecef; }
        .actions { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .info-box { background: #f0f3ff; border-left: 4px solid #5e72e4; padding: 15px; margin-top: 20px; border-radius: 4px; }
        .info-box h4 { color: #5e72e4; margin-bottom: 8px; }
        .info-box p { color: #525f7f; font-size: 0.95em; line-height: 1.6; }
        .preview { background: #f7f8fc; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .preview h3 { color: #32325d; margin-bottom: 15px; }
        .domain-list { font-family: 'Courier New', monospace; font-size: 0.9em; color: #525f7f; line-height: 1.8; max-height: 300px; overflow-y: auto; }
        .domain-item { padding: 5px 0; border-bottom: 1px solid #e9ecef; }
        .badge { display: inline-block; padding: 4px 10px; background: #5e72e4; color: white; border-radius: 12px; font-size: 0.85em; margin-left: 10px; }
        @media (max-width: 768px) { .security-level, .actions { flex-direction: column; } .language-toggle { position: static; margin-bottom: 20px; justify-content: center; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="lang-btn active" data-lang="de">Deutsch</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
            <h1>üõ°Ô∏è <span data-i18n="title">SEB Konfigurations-Generator</span></h1>
            <p data-i18n="subtitle">Erstellen Sie Safe Exam Browser Konfigurationen f√ºr Fokus-Modus im Bildungsbereich</p>
        </div>
        <div class="content">
            <div class="section">
                <h2><span data-i18n="step1">1. Dienst ausw√§hlen</span></h2>
                <div class="preset-buttons" id="presetButtons"></div>
            </div>
            <div class="section">
                <h2><span data-i18n="step2">2. Konfigurationseinstellungen</span></h2>
                <div class="form-group">
                    <label data-i18n="startUrl">Start-URL</label>
                    <input type="url" id="startUrl" placeholder="https://www.onenote.com/notebooks">
                </div>
                <div class="form-group">
                    <label data-i18n="configName">Konfigurationsname</label>
                    <input type="text" id="configName" placeholder="Meine_Schule_OneNote">
                </div>
                <div class="form-group">
                    <label data-i18n="securityLevel">Sicherheitsstufe</label>
                    <div class="security-level" id="securityLevel"></div>
                </div>
                <div class="form-group">
                    <label data-i18n="additionalOptions">Zus√§tzliche Optionen</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowDownloads" checked>
                        <label for="allowDownloads" data-i18n="allowDownloads">Datei-Downloads erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowSpellCheck" checked>
                        <label for="allowSpellCheck" data-i18n="allowSpellCheck">Rechtschreibpr√ºfung erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showReloadButton" checked>
                        <label for="showReloadButton" data-i18n="showReloadButton">Neu-Laden-Button anzeigen</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowBackForward" checked>
                        <label for="allowBackForward" data-i18n="allowBackForward">Vor/Zur√ºck-Navigation erlauben</label>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2><span data-i18n="step3">3. Benutzerdefinierte Domains (Optional)</span></h2>
                <div class="form-group">
                    <label data-i18n="customDomainsLabel">Zus√§tzliche erlaubte Domains hinzuf√ºgen (eine pro Zeile)</label>
                    <textarea id="customDomains" data-i18n-placeholder="customDomainsPlaceholder" placeholder="beispiel.de&#10;*.schule-domain.de"></textarea>
                </div>
                <div class="info-box">
                    <h4 data-i18n="proTipTitle">üí° Profi-Tipp</h4>
                    <p data-i18n="proTipText">Verwenden Sie Wildcards (*) um alle Subdomains zu erlauben. Zum Beispiel: <code>*.microsoft.com</code> erlaubt login.microsoft.com, account.microsoft.com, usw.</p>
                </div>
            </div>
            <div class="section">
                <h2><span data-i18n="step4">4. Vorschau & Download</span></h2>
                <div class="preview">
                    <h3><span data-i18n="allowedDomains">Erlaubte Domains</span> <span class="badge" id="domainCount">0</span></h3>
                    <div class="domain-list" id="domainPreview"></div>
                </div>
                <div class="actions">
                    <button class="btn btn-primary" id="generateBtn">
                        <span data-i18n="downloadBtn">üì• SEB Konfiguration herunterladen (.seb)</span>
                    </button>
                    <button class="btn btn-secondary" id="copyBtn">
                        <span data-i18n="copyBtn">üìã Domain-Liste kopieren</span>
                    </button>
                </div>
                <div class="info-box">
                    <h4 data-i18n="nextStepsTitle">N√§chste Schritte</h4>
                    <p data-i18n="nextStepsText">
                        1. SEB-Konfigurationsdatei herunterladen (.seb)<br>
                        2. Im SEB Config Tool √∂ffnen<br>
                        3. Einstellungen verfeinern und verschl√ºsseln<br>
                        4. Als finale .seb-Datei speichern<br>
                        5. Verschl√ºsselte Datei an Sch√ºler*innen verteilen
                    </p>
                </div>
                <div class="info-box">
                    <h4>üîß <span data-i18n="helperScriptTitle">Network Capture Helper</span></h4>
                    <p data-i18n="helperScriptText">
                        Ben√∂tigen Sie Hilfe beim Erfassen von Netzwerk-Domains? W√§hlen Sie die passende Methode f√ºr Ihr System:
                    </p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="scripts/capture-helper.ps1" download class="btn btn-secondary" style="text-decoration: none; flex: 1; min-width: 200px;">
                            <span data-i18n="downloadHelperBtn">‚¨áÔ∏è PowerShell (Windows)</span>
                        </a>
                        <button class="btn btn-secondary" id="browserHelperBtn" style="flex: 1; min-width: 200px;">
                            <span data-i18n="browserHelperBtn">üåê Browser-Methode (Alle OS)</span>
                        </button>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em;">
                        <span data-i18n="helperScriptInstructions">
                            üìñ Anleitungen: 
                            <a href="docs/de/BROWSER_CAPTURE_ANLEITUNG.md" target="_blank" style="color: #5e72e4;">Browser (DE)</a> | 
                            <a href="docs/en/BROWSER_CAPTURE_GUIDE.md" target="_blank" style="color: #5e72e4;">Browser (EN)</a> | 
                            <a href="docs/de/SCHNELLSTART_ANLEITUNG.md" target="_blank" style="color: #5e72e4;">PowerShell (DE)</a> | 
                            <a href="docs/en/TEACHER_GUIDE.md" target="_blank" style="color: #5e72e4;">PowerShell (EN)</a>
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
// ============================================================================
// TRANSLATIONS / √úBERSETZUNGEN
// ============================================================================
const TRANSLATIONS = {
    de: {
        title: "SEB Konfigurations-Generator",
        subtitle: "Erstellen Sie Safe Exam Browser Konfigurationen f√ºr Fokus-Modus im Bildungsbereich",
        step1: "1. Dienst ausw√§hlen",
        step2: "2. Konfigurationseinstellungen",
        step3: "3. Benutzerdefinierte Domains (Optional)",
        step4: "4. Vorschau & Download",
        startUrl: "Start-URL",
        configName: "Konfigurationsname",
        securityLevel: "Sicherheitsstufe",
        additionalOptions: "Zus√§tzliche Optionen",
        allowDownloads: "Datei-Downloads erlauben",
        allowSpellCheck: "Rechtschreibpr√ºfung erlauben",
        showReloadButton: "Neu-Laden-Button anzeigen",
        allowBackForward: "Vor/Zur√ºck-Navigation erlauben",
        customDomainsLabel: "Zus√§tzliche erlaubte Domains hinzuf√ºgen (eine pro Zeile)",
        customDomainsPlaceholder: "beispiel.de\n*.schule-domain.de",
        proTipTitle: "üí° Profi-Tipp",
        proTipText: "Verwenden Sie Wildcards (*) um alle Subdomains zu erlauben. Zum Beispiel: *.microsoft.com erlaubt login.microsoft.com, account.microsoft.com, usw.",
        allowedDomains: "Erlaubte Domains",
        downloadBtn: "üì• SEB Konfiguration herunterladen (.seb)",
        copyBtn: "üìã Domain-Liste kopieren",
        nextStepsTitle: "N√§chste Schritte",
        nextStepsText: "1. SEB-Konfigurationsdatei herunterladen (.seb)<br>2. Im SEB Config Tool √∂ffnen<br>3. Einstellungen verfeinern und verschl√ºsseln<br>4. Als finale .seb-Datei speichern<br>5. Verschl√ºsselte Datei an Sch√ºler*innen verteilen",
        helperScriptTitle: "Network Capture Helper",
        helperScriptText: "Ben√∂tigen Sie Hilfe beim Erfassen von Netzwerk-Domains? W√§hlen Sie die passende Methode f√ºr Ihr System:",
        downloadHelperBtn: "‚¨áÔ∏è PowerShell (Windows)",
        browserHelperBtn: "üåê Browser-Methode (Alle OS)",
        helperScriptInstructions: "üìñ Anleitungen:",
        
        // Presets
        presetOnenote: "OneNote Online",
        presetOnenoteDesc: "Microsoft OneNote Web-Client",
        presetWord: "Word Online",
        presetWordDesc: "Microsoft Word Web-Client",
        presetTeams: "Microsoft Teams",
        presetTeamsDesc: "Teams Web-Client f√ºr Zusammenarbeit",
        presetGdocs: "Google Docs",
        presetGdocsDesc: "Google Workspace Dokumenteneditor",
        presetGsheets: "Google Tabellen",
        presetGsheetsDesc: "Google Workspace Tabellenkalkulation",
        
        // Security levels
        securityRelaxed: "Locker",
        securityRelaxedDesc: "Fokus-Modus - blockiert Ablenkungen, erlaubt Flexibilit√§t",
        securityBalanced: "Ausgewogen",
        securityBalancedDesc: "Empfohlen - gutes Gleichgewicht zwischen Sicherheit und Benutzerfreundlichkeit",
        securityStrict: "Streng",
        securityStrictDesc: "Maximale Einschr√§nkungen (kann Sch√ºler frustrieren)",
        
        // Messages
        copiedMsg: "‚úì Kopiert!",
        configNamePlaceholder: "Meine_Schule_"
    },
    en: {
        title: "SEB Config Generator",
        subtitle: "Create Safe Exam Browser configurations for educational focus mode",
        step1: "1. Choose Service",
        step2: "2. Configuration Settings",
        step3: "3. Custom Domains (Optional)",
        step4: "4. Preview & Download",
        startUrl: "Start URL",
        configName: "Configuration Name",
        securityLevel: "Security Level",
        additionalOptions: "Additional Options",
        allowDownloads: "Allow file downloads",
        allowSpellCheck: "Allow spell check",
        showReloadButton: "Show reload button",
        allowBackForward: "Allow back/forward navigation",
        customDomainsLabel: "Add additional allowed domains (one per line)",
        customDomainsPlaceholder: "example.com\n*.school-domain.edu",
        proTipTitle: "üí° Pro Tip",
        proTipText: "Use wildcards (*) to allow all subdomains. For example: *.microsoft.com allows login.microsoft.com, account.microsoft.com, etc.",
        allowedDomains: "Allowed Domains",
        downloadBtn: "üì• Download SEB Config (.seb)",
        copyBtn: "üìã Copy Domain List",
        nextStepsTitle: "Next Steps",
        nextStepsText: "1. Download the SEB configuration file (.seb)<br>2. Open in SEB Config Tool<br>3. Refine settings and encrypt<br>4. Save as final .seb file<br>5. Distribute encrypted file to students",
        helperScriptTitle: "Network Capture Helper",
        helperScriptText: "Need help capturing network domains? Choose the method that works for your system:",
        downloadHelperBtn: "‚¨áÔ∏è PowerShell (Windows)",
        browserHelperBtn: "üåê Browser Method (All OS)",
        helperScriptInstructions: "üìñ Guides:",
        
        // Presets
        presetOnenote: "OneNote Online",
        presetOnenoteDesc: "Microsoft OneNote web client",
        presetWord: "Word Online",
        presetWordDesc: "Microsoft Word web client",
        presetTeams: "Microsoft Teams",
        presetTeamsDesc: "Teams web client for collaboration",
        presetGdocs: "Google Docs",
        presetGdocsDesc: "Google Workspace document editor",
        presetGsheets: "Google Sheets",
        presetGsheetsDesc: "Google Workspace spreadsheet editor",
        
        // Security levels
        securityRelaxed: "Relaxed",
        securityRelaxedDesc: "Focus mode - blocks distractions but allows flexibility",
        securityBalanced: "Balanced",
        securityBalancedDesc: "Recommended - good balance of security and usability",
        securityStrict: "Strict",
        securityStrictDesc: "Maximum restrictions (may frustrate students)",
        
        // Messages
        copiedMsg: "‚úì Copied!",
        configNamePlaceholder: "My_School_"
    }
};

// ============================================================================
// PRESET CONFIGURATIONS
// ============================================================================
const PRESETS = {
    onenote: {
        startUrl: "https://www.onenote.com/notebooks",
        domains: ["*.microsoft.com","*.microsoftonline.com","*.msauth.net","*.msftauth.net","login.live.com","account.live.com","*.live.com","*.office.com","*.office365.com","*.officeapps.live.com","*.sharepoint.com","*.sharepointonline.com","*.onenote.com","onenote.officeapps.live.com","*.msocdn.com","*.msecnd.net","*.azureedge.net","*.windows.net"]
    },
    word: {
        startUrl: "https://www.office.com/launch/word",
        domains: ["*.microsoft.com","*.microsoftonline.com","*.msauth.net","*.msftauth.net","login.live.com","account.live.com","*.live.com","*.office.com","*.office365.com","*.officeapps.live.com","*.sharepoint.com","*.sharepointonline.com","*.msocdn.com","*.msecnd.net","*.azureedge.net","*.windows.net"]
    },
    teams: {
        startUrl: "https://teams.microsoft.com",
        domains: ["*.microsoft.com","*.microsoftonline.com","*.msauth.net","*.msftauth.net","login.live.com","*.live.com","*.office.com","*.office365.com","*.teams.microsoft.com","*.skype.com","*.sharepoint.com","*.msocdn.com","*.msecnd.net","*.azureedge.net"]
    },
    gdocs: {
        startUrl: "https://docs.google.com",
        domains: ["*.google.com","*.googleapis.com","*.gstatic.com","accounts.google.com","docs.google.com","drive.google.com","*.googleusercontent.com"]
    },
    gsheets: {
        startUrl: "https://sheets.google.com",
        domains: ["*.google.com","*.googleapis.com","*.gstatic.com","accounts.google.com","sheets.google.com","drive.google.com","*.googleusercontent.com"]
    }
};

const SECURITY_LEVELS = {
    relaxed: {
        settings: {allowSwitchToApplications:false,allowQuit:true,browserViewMode:0,enableBrowserWindowToolbar:true,showMenuBar:false}
    },
    balanced: {
        settings: {allowSwitchToApplications:false,allowQuit:true,browserViewMode:0,enableBrowserWindowToolbar:true,showMenuBar:false}
    },
    strict: {
        settings: {allowSwitchToApplications:false,allowQuit:false,browserViewMode:1,enableBrowserWindowToolbar:false,showMenuBar:false}
    }
};

// ============================================================================
// STATE
// ============================================================================
let currentLang = 'de';
let currentPreset = 'onenote';
let currentSecurityLevel = 'balanced';

// ============================================================================
// LANGUAGE MANAGEMENT
// ============================================================================
function setLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (TRANSLATIONS[lang][key]) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                el.placeholder = TRANSLATIONS[lang][key];
            } else {
                el.innerHTML = TRANSLATIONS[lang][key];
            }
        }
    });
    
    // Update placeholder attributes
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (TRANSLATIONS[lang][key]) {
            el.placeholder = TRANSLATIONS[lang][key];
        }
    });
    
    // Update language toggle buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });
    
    // Re-render dynamic content
    renderPresets();
    renderSecurityLevels();
    
    // Save language preference
    localStorage.setItem('sebConfigLang', lang);
}

function t(key) {
    return TRANSLATIONS[currentLang][key] || key;
}

// ============================================================================
// UI RENDERING
// ============================================================================
function renderPresets() {
    const container = document.getElementById('presetButtons');
    container.innerHTML = '';
    
    const presetKeys = ['onenote', 'word', 'teams', 'gdocs', 'gsheets'];
    
    presetKeys.forEach(key => {
        const btn = document.createElement('button');
        btn.className = `preset-btn ${key === currentPreset ? 'active' : ''}`;
        btn.innerHTML = `
            <h3>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1))}</h3>
            <p>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        btn.onclick = () => selectPreset(key);
        container.appendChild(btn);
    });
}

function renderSecurityLevels() {
    const container = document.getElementById('securityLevel');
    container.innerHTML = '';
    
    ['relaxed', 'balanced', 'strict'].forEach(key => {
        const div = document.createElement('div');
        div.className = `security-option ${key === currentSecurityLevel ? 'active' : ''}`;
        div.innerHTML = `
            <h4>${t('security' + key.charAt(0).toUpperCase() + key.slice(1))}</h4>
            <p>${t('security' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        div.onclick = () => selectSecurityLevel(key);
        container.appendChild(div);
    });
}

function selectPreset(key) {
    currentPreset = key;
    const preset = PRESETS[key];
    document.getElementById('startUrl').value = preset.startUrl;
    
    const presetName = t('preset' + key.charAt(0).toUpperCase() + key.slice(1));
    document.getElementById('configName').value = `${presetName.replace(/\s+/g, '_')}_Config`;
    
    renderPresets();
    updatePreview();
}

function selectSecurityLevel(key) {
    currentSecurityLevel = key;
    renderSecurityLevels();
}

function getAllDomains() {
    const preset = PRESETS[currentPreset];
    const customDomains = document.getElementById('customDomains').value
        .split('\n')
        .map(d => d.trim())
        .filter(d => d && !d.startsWith('#'));
    
    return [...preset.domains, ...customDomains];
}

function updatePreview() {
    const domains = getAllDomains();
    const container = document.getElementById('domainPreview');
    document.getElementById('domainCount').textContent = domains.length;
    
    container.innerHTML = domains
        .map(domain => `<div class="domain-item">${domain}</div>`)
        .join('');
}

// ============================================================================
// CONFIG GENERATION - XML (PLIST)
// ============================================================================
function generateConfigXML() {
    const preset = PRESETS[currentPreset];
    const securitySettings = SECURITY_LEVELS[currentSecurityLevel].settings;
    const domains = getAllDomains();
    const startUrl = document.getElementById('startUrl').value;
    
    // Build URL filter rules XML
    let urlFilterRulesXML = '';
    domains.forEach(domain => {
        urlFilterRulesXML += `\t\t<dict>
\t\t\t<key>action</key>
\t\t\t<integer>1</integer>
\t\t\t<key>active</key>
\t\t\t<true/>
\t\t\t<key>expression</key>
\t\t\t<string>${escapeXML(domain)}</string>
\t\t\t<key>regex</key>
\t\t\t<false/>
\t\t</dict>
`;
    });
    
    // Generate complete plist XML
    const xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
\t<key>URLFilterEnable</key>
\t<${urlFilterRulesXML.length > 0 ? 'true' : 'false'}/>
\t<key>URLFilterEnableContentFilter</key>
\t<false/>
\t<key>URLFilterRules</key>
\t<array>
${urlFilterRulesXML}\t</array>
\t<key>allowAudioCapture</key>
\t<false/>
\t<key>allowBrowsingBackForward</key>
\t<${document.getElementById('allowBackForward').checked ? 'true' : 'false'}/>
\t<key>allowDictionaryLookup</key>
\t<false/>
\t<key>allowDownUploads</key>
\t<${document.getElementById('allowDownloads').checked ? 'true' : 'false'}/>
\t<key>allowDownloads</key>
\t<${document.getElementById('allowDownloads').checked ? 'true' : 'false'}/>
\t<key>allowFlashFullscreen</key>
\t<false/>
\t<key>allowPreferencesWindow</key>
\t<false/>
\t<key>allowQuit</key>
\t<${securitySettings.allowQuit ? 'true' : 'false'}/>
\t<key>allowSpellCheck</key>
\t<${document.getElementById('allowSpellCheck').checked ? 'true' : 'false'}/>
\t<key>allowSwitchToApplications</key>
\t<${securitySettings.allowSwitchToApplications ? 'true' : 'false'}/>
\t<key>allowVideoCapture</key>
\t<false/>
\t<key>browserViewMode</key>
\t<integer>${securitySettings.browserViewMode}</integer>
\t<key>browserWindowAllowReload</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>enableBrowserWindowToolbar</key>
\t<${securitySettings.enableBrowserWindowToolbar ? 'true' : 'false'}/>
\t<key>enablePlugIns</key>
\t<true/>
\t<key>enableSebBrowser</key>
\t<true/>
\t<key>enableZoomPage</key>
\t<true/>
\t<key>enableZoomText</key>
\t<true/>
\t<key>examSessionClearCookiesOnEnd</key>
\t<true/>
\t<key>examSessionClearCookiesOnStart</key>
\t<true/>
\t<key>newBrowserWindowAllowReload</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>originatorVersion</key>
\t<string>SEB_Generator_1.0</string>
\t<key>removeBrowserProfile</key>
\t<false/>
\t<key>showMenuBar</key>
\t<${securitySettings.showMenuBar ? 'true' : 'false'}/>
\t<key>showReloadButton</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>startURL</key>
\t<string>${escapeXML(startUrl)}</string>
\t<key>touchOptimized</key>
\t<false/>
</dict>
</plist>`;
    
    return xml;
}

function escapeXML(str) {
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&apos;');
}

function downloadConfig() {
    const configXML = generateConfigXML();
    const configName = document.getElementById('configName').value || 'SEB_Config';
    const blob = new Blob([configXML], { type: 'application/xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${configName}.seb`;
    a.click();
    URL.revokeObjectURL(url);
}

function copyDomains() {
    const domains = getAllDomains().join('\n');
    navigator.clipboard.writeText(domains).then(() => {
        const btn = document.getElementById('copyBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = t('copiedMsg');
        setTimeout(() => {
            btn.innerHTML = originalText;
        }, 2000);
    });
}

// ============================================================================
// BROWSER HELPER FUNCTIONALITY
// ============================================================================
function showBrowserHelper() {
    const script = `// SEB Domain Capture Script
(function() {
    console.clear();
    console.log('%cüõ°Ô∏è SEB Domain Capture', 'font-size:20px; color:#5e72e4; font-weight:bold;');
    console.log('%c' + '='.repeat(60), 'color:#ccc;');
    
    const domains = new Set();
    
    performance.getEntries().forEach(entry => {
        try {
            const url = new URL(entry.name);
            if (url.hostname && !url.hostname.match(/^(localhost|127\\\\.0\\\\.0\\\\.1|::1)$/)) {
                domains.add(url.hostname);
            }
        } catch (e) {}
    });
    
    const sorted = [...domains].sort();
    
    console.log(\`\\nüìä Found \${sorted.length} unique domains:\\n\`);
    sorted.forEach(domain => console.log(\`  \${domain}\`));
    console.log('\\n' + '='.repeat(60));
    
    const wildcards = new Set();
    sorted.forEach(domain => {
        const parts = domain.split('.');
        if (parts.length > 2) {
            wildcards.add('*.' + parts.slice(-2).join('.'));
        } else {
            wildcards.add(domain);
        }
    });
    
    console.log(\`\\nüåü Recommended wildcards (\${wildcards.size} domains):\\n\`);
    [...wildcards].sort().forEach(domain => console.log(\`  \${domain}\`));
    console.log('\\n' + '='.repeat(60));
    
    const output = sorted.join('\\n');
    
    navigator.clipboard.writeText(output).then(() => {
        console.log('\\n%c‚úì COPIED TO CLIPBOARD!', 'color:green; font-size:16px; font-weight:bold;');
        console.log('%cPaste into "Custom Domains" field', 'color:#666; font-style:italic;');
    }).catch(() => {
        console.log('\\n%c‚ö†Ô∏è Could not auto-copy. Copy manually:', 'color:orange; font-weight:bold;');
        console.log('\\n' + output);
    });
    
    console.log('\\n' + '='.repeat(60) + '\\n');
})();`;

    const bookmarklet = `javascript:(function(){const domains=new Set();performance.getEntries().forEach(e=>{try{const u=new URL(e.name);if(u.hostname&&!u.hostname.match(/^(localhost|127\\\\.0\\\\.0\\\\.1|::1)$/)){domains.add(u.hostname)}}catch(err){}});const sorted=[...domains].sort();let output='SEB Domain Capture\\n'+'='.repeat(50)+'\\n\\n';output+='Total domains: '+sorted.length+'\\n\\n';output+='DOMAINS:\\n'+'-'.repeat(50)+'\\n';output+=sorted.join('\\n')+'\\n';output+='-'.repeat(50)+'\\n\\n';output+='Wildcards (recommended):\\n'+'-'.repeat(50)+'\\n';const wildcards=new Set();sorted.forEach(d=>{const parts=d.split('.');if(parts.length>2){wildcards.add('*.'+parts.slice(-2).join('.'))}else{wildcards.add(d)}});output+=[...wildcards].sort().join('\\n');const modal=document.createElement('div');modal.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:999999;max-width:600px;max-height:80vh;overflow:auto;font-family:monospace;';const pre=document.createElement('pre');pre.textContent=output;pre.style.cssText='background:#f5f5f5;padding:15px;border-radius:6px;overflow:auto;max-height:400px;font-size:12px;';const btnContainer=document.createElement('div');btnContainer.style.cssText='margin-top:20px;display:flex;gap:10px;';const copyBtn=document.createElement('button');copyBtn.textContent='üìã Copy';copyBtn.style.cssText='padding:12px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;flex:1;';copyBtn.onclick=()=>{navigator.clipboard.writeText(sorted.join('\\n')).then(()=>{copyBtn.textContent='‚úì Copied!';setTimeout(()=>copyBtn.textContent='üìã Copy',2000)})};const closeBtn=document.createElement('button');closeBtn.textContent='‚úï';closeBtn.style.cssText='padding:12px 20px;background:#e9ecef;color:#32325d;border:none;border-radius:6px;cursor:pointer;font-weight:600;';closeBtn.onclick=()=>modal.remove();btnContainer.appendChild(copyBtn);btnContainer.appendChild(closeBtn);modal.appendChild(pre);modal.appendChild(btnContainer);document.body.appendChild(modal)})();`;

    const instructions = currentLang === 'de' 
        ? {
            title: 'üåê Browser-basierte Domain-Erfassung',
            method1: 'Methode 1: Console Script (Empfohlen)',
            method1Steps: [
                '1. √ñffnen Sie den Dienst (z.B. OneNote) in einem neuen Tab',
                '2. Dr√ºcken Sie F12 um DevTools zu √∂ffnen',
                '3. Gehen Sie zum Tab "Konsole"',
                '4. Kopieren Sie das Skript unten und f√ºgen Sie es ein',
                '5. Dr√ºcken Sie Enter',
                '6. Domains werden automatisch kopiert!',
                '7. F√ºgen Sie sie ins Feld "Benutzerdefinierte Domains" ein'
            ],
            method2: 'Methode 2: Bookmarklet',
            method2Steps: [
                '1. Erstellen Sie ein neues Lesezeichen',
                '2. Kopieren Sie den Bookmarklet-Code unten',
                '3. F√ºgen Sie ihn als URL des Lesezeichens ein',
                '4. √ñffnen Sie Ihren Dienst und klicken Sie das Lesezeichen',
                '5. Ein Dialog zeigt alle Domains'
            ],
            consoleLabel: 'Console Script:',
            bookmarkletLabel: 'Bookmarklet Code:',
            copyScript: 'üìã Script kopieren',
            copyBookmarklet: 'üìã Bookmarklet kopieren',
            fullGuide: 'üìñ Vollst√§ndige Anleitung',
            close: 'Schlie√üen'
        }
        : {
            title: 'üåê Browser-Based Domain Capture',
            method1: 'Method 1: Console Script (Recommended)',
            method1Steps: [
                '1. Open your service (e.g., OneNote) in a new tab',
                '2. Press F12 to open DevTools',
                '3. Go to the "Console" tab',
                '4. Copy the script below and paste it',
                '5. Press Enter',
                '6. Domains will be automatically copied!',
                '7. Paste them into the "Custom Domains" field'
            ],
            method2: 'Method 2: Bookmarklet',
            method2Steps: [
                '1. Create a new bookmark',
                '2. Copy the bookmarklet code below',
                '3. Paste it as the bookmark URL',
                '4. Open your service and click the bookmark',
                '5. A dialog will show all domains'
            ],
            consoleLabel: 'Console Script:',
            bookmarkletLabel: 'Bookmarklet Code:',
            copyScript: 'üìã Copy Script',
            copyBookmarklet: 'üìã Copy Bookmarklet',
            fullGuide: 'üìñ Full Guide',
            close: 'Close'
        };

    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;';
    
    const content = document.createElement('div');
    content.style.cssText = 'background:white;border-radius:12px;padding:30px;max-width:800px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);';
    
    content.innerHTML = `
        <h2 style="color:#5e72e4;margin-bottom:20px;">${instructions.title}</h2>
        
        <div style="background:#f0f3ff;padding:20px;border-radius:8px;margin-bottom:20px;">
            <h3 style="color:#5e72e4;margin-bottom:15px;">${instructions.method1}</h3>
            ${instructions.method1Steps.map(step => `<div style="margin:8px 0;">${step}</div>`).join('')}
            
            <div style="margin-top:15px;">
                <label style="font-weight:600;color:#32325d;display:block;margin-bottom:8px;">${instructions.consoleLabel}</label>
                <textarea readonly style="width:100%;height:120px;font-family:monospace;font-size:12px;padding:10px;border:2px solid #e9ecef;border-radius:6px;resize:vertical;">${script}</textarea>
                <button id="copyScriptBtn" style="margin-top:10px;padding:10px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.copyScript}</button>
            </div>
        </div>
        
        <div style="background:#f7f8fc;padding:20px;border-radius:8px;margin-bottom:20px;">
            <h3 style="color:#5e72e4;margin-bottom:15px;">${instructions.method2}</h3>
            ${instructions.method2Steps.map(step => `<div style="margin:8px 0;">${step}</div>`).join('')}
            
            <div style="margin-top:15px;">
                <label style="font-weight:600;color:#32325d;display:block;margin-bottom:8px;">${instructions.bookmarkletLabel}</label>
                <textarea readonly style="width:100%;height:100px;font-family:monospace;font-size:11px;padding:10px;border:2px solid #e9ecef;border-radius:6px;resize:vertical;">${bookmarklet}</textarea>
                <button id="copyBookmarkletBtn" style="margin-top:10px;padding:10px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.copyBookmarklet}</button>
            </div>
        </div>
        
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:20px;">
            <a href="docs/${currentLang}/BROWSER_CAPTURE_${currentLang === 'de' ? 'ANLEITUNG' : 'GUIDE'}.md" target="_blank" style="padding:12px 24px;background:#f7f8fc;color:#5e72e4;border:2px solid #e9ecef;border-radius:6px;text-decoration:none;font-weight:600;">${instructions.fullGuide}</a>
            <button id="closeBrowserHelperBtn" style="padding:12px 24px;background:#e9ecef;color:#32325d;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.close}</button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Event listeners
    document.getElementById('copyScriptBtn').addEventListener('click', () => {
        navigator.clipboard.writeText(script);
        const btn = document.getElementById('copyScriptBtn');
        const original = btn.textContent;
        btn.textContent = '‚úì ' + (currentLang === 'de' ? 'Kopiert!' : 'Copied!');
        setTimeout(() => btn.textContent = original, 2000);
    });
    
    document.getElementById('copyBookmarkletBtn').addEventListener('click', () => {
        navigator.clipboard.writeText(bookmarklet);
        const btn = document.getElementById('copyBookmarkletBtn');
        const original = btn.textContent;
        btn.textContent = '‚úì ' + (currentLang === 'de' ? 'Kopiert!' : 'Copied!');
        setTimeout(() => btn.textContent = original, 2000);
    });
    
    document.getElementById('closeBrowserHelperBtn').addEventListener('click', () => {
        modal.remove();
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
}

// ============================================================================
// EVENT LISTENERS
// ============================================================================
function attachEventListeners() {
    // Language toggle
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
    });
    
    // Main actions
    document.getElementById('generateBtn').addEventListener('click', downloadConfig);
    document.getElementById('copyBtn').addEventListener('click', copyDomains);
    document.getElementById('customDomains').addEventListener('input', updatePreview);
    document.getElementById('startUrl').addEventListener('input', updatePreview);
    
    // Browser helper
    document.getElementById('browserHelperBtn').addEventListener('click', showBrowserHelper);
}

// ============================================================================
// INITIALIZATION
// ============================================================================
function init() {
    // Load saved language preference or default to German
    const savedLang = localStorage.getItem('sebConfigLang') || 'de';
    setLanguage(savedLang);
    
    attachEventListeners();
    updatePreview();
}

// Start the application
init();
    </script>
</body>
</html>
