<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEB Konfigurations-Generator</title>
    <style>
        /* ============================================================================
           COLOR PALETTE - Soft Navy Blue Theme (#2c3e5a)
           ============================================================================
           Primary: #2c3e5a (Navy Soft), #3d5170 (Navy Medium), #4a6fa5 (Blue Medium)
           Accent: #5b9bd5 (Sky Blue), #7eb8e6 (Light Blue), #2dce89 (Success Green)
           Backgrounds: #e8edf5 (Soft Blue-Gray), #f5f7fb (Light Blue-Gray), #dfe6f0 (Blue-Tint)
           Text: #2c3e5a (Navy Soft), #525f7f (Gray Medium), #6c7a89 (Gray Light)
           Version/Footer: #8898aa (Medium Gray on dark background)
           ============================================================================ */
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; 
            background: linear-gradient(135deg, #3d5170 0%, #4a6fa5 100%); 
            min-height: 100vh; 
            padding: 20px; 
        }
        
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: #e8edf5; 
            border-radius: 12px; 
            box-shadow: 0 20px 60px rgba(44, 62, 90, 0.3); 
            overflow: hidden; 
        }
        
        .header { 
            background: linear-gradient(135deg, #2c3e5a 0%, #3d5170 100%); 
            color: #f5f7fb; 
            padding: 40px 30px; 
            text-align: center; 
            position: relative; 
        }
        
        .language-toggle { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            display: flex; 
            gap: 10px; 
        }
        
        .lang-btn { 
            background: rgba(245, 247, 251, 0.15); 
            border: 2px solid rgba(245, 247, 251, 0.4); 
            color: #f5f7fb; 
            padding: 8px 15px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        
        .lang-btn:hover { 
            background: rgba(245, 247, 251, 0.25); 
            border-color: rgba(245, 247, 251, 0.6); 
        }
        
        .lang-btn.active { 
            background: #5b9bd5; 
            color: #f5f7fb; 
            border-color: #5b9bd5; 
        }
        
        .header h1 { 
            font-size: 2em; 
            margin-bottom: 10px; 
        }
        
        .header p { 
            opacity: 0.9; 
            font-size: 1.1em; 
        }
        
        .content { 
            padding: 40px 30px; 
        }
        
        .section { 
            margin-bottom: 40px; 
        }
        
        .section h2 { 
            color: #2c3e5a; 
            margin-bottom: 20px; 
            padding-bottom: 10px; 
            border-bottom: 2px solid #5b9bd5; 
        }
        
        .form-group { 
            margin-bottom: 25px; 
        }
        
        label { 
            display: block; 
            font-weight: 600; 
            color: #2c3e5a; 
            margin-bottom: 8px; 
        }
        
        input[type="text"], 
        input[type="url"], 
        textarea, 
        select { 
            width: 100%; 
            padding: 12px 15px; 
            border: 2px solid #dfe6f0; 
            border-radius: 6px; 
            font-size: 14px; 
            background: #f5f7fb; 
            color: #2c3e5a; 
            transition: all 0.3s; 
        }
        
        input:focus, 
        textarea:focus, 
        select:focus { 
            outline: none; 
            border-color: #5b9bd5; 
            background: #ffffff; 
            box-shadow: 0 0 0 3px rgba(91, 155, 213, 0.15); 
        }
        
        textarea { 
            min-height: 150px; 
            font-family: 'Courier New', monospace; 
            resize: vertical; 
        }
        
        .preset-buttons { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-top: 15px; 
        }
        
        .preset-btn { 
            padding: 15px; 
            border: 2px solid #dfe6f0; 
            border-radius: 8px; 
            background: #f5f7fb; 
            cursor: pointer; 
            transition: all 0.3s; 
            text-align: left; 
        }
        
        .preset-btn:hover { 
            border-color: #5b9bd5; 
            background: #ffffff; 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(91, 155, 213, 0.25); 
        }
        
        .preset-btn.active { 
            border-color: #5b9bd5; 
            background: linear-gradient(135deg, #d4e6f7 0%, #e8f2fa 100%); 
            box-shadow: 0 0 0 3px rgba(91, 155, 213, 0.2); 
        }
        
        .preset-btn h3 { 
            color: #2c3e5a; 
            margin-bottom: 5px; 
            font-size: 1.1em; 
        }
        
        .preset-btn p { 
            color: #6c7a89; 
            font-size: 0.9em; 
        }
        
        .checkbox-group { 
            display: flex; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        .checkbox-group input[type="checkbox"] { 
            width: 20px; 
            height: 20px; 
            margin-right: 10px; 
            cursor: pointer; 
            accent-color: #5b9bd5; 
        }
        
        .security-level { 
            display: flex; 
            gap: 15px; 
            margin-top: 15px; 
        }
        
        .security-option { 
            flex: 1; 
            padding: 20px; 
            border: 2px solid #dfe6f0; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s; 
            background: #f5f7fb; 
        }
        
        .security-option:hover { 
            border-color: #5b9bd5; 
            background: #ffffff; 
        }
        
        .security-option.active { 
            border-color: #5b9bd5; 
            background: linear-gradient(135deg, #d4e6f7 0%, #e8f2fa 100%); 
            box-shadow: 0 0 0 3px rgba(91, 155, 213, 0.2); 
        }
        
        .security-option h4 { 
            color: #2c3e5a; 
            margin-bottom: 8px; 
        }
        
        .security-option p { 
            color: #6c7a89; 
            font-size: 0.9em; 
        }
        
        .btn { 
            padding: 15px 30px; 
            border: none; 
            border-radius: 6px; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: inline-flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #4a6fa5 0%, #5b9bd5 100%); 
            color: #f5f7fb; 
            box-shadow: 0 4px 12px rgba(74, 111, 165, 0.3); 
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 20px rgba(74, 111, 165, 0.4); 
        }
        
        .btn-secondary { 
            background: #f5f7fb; 
            color: #2c3e5a; 
            border: 2px solid #dfe6f0; 
        }
        
        .btn-secondary:hover { 
            background: #ffffff; 
            border-color: #5b9bd5; 
        }
        
        .actions { 
            display: flex; 
            gap: 15px; 
            margin-top: 30px; 
            flex-wrap: wrap; 
        }
        
        .info-box { 
            background: linear-gradient(135deg, #d4e6f7 0%, #e8f2fa 100%); 
            border-left: 4px solid #5b9bd5; 
            padding: 15px; 
            margin-top: 20px; 
            border-radius: 4px; 
        }
        
        .info-box h4 { 
            color: #2c3e5a; 
            margin-bottom: 8px; 
        }
        
        .info-box p { 
            color: #3d5170; 
            font-size: 0.95em; 
            line-height: 1.6; 
        }
        
        .preview { 
            background: #f5f7fb; 
            padding: 20px; 
            border-radius: 8px; 
            margin-top: 20px; 
            border: 2px solid #dfe6f0; 
        }
        
        .preview h3 { 
            color: #2c3e5a; 
            margin-bottom: 15px; 
        }
        
        .domain-list { 
            font-family: 'Courier New', monospace; 
            font-size: 0.9em; 
            color: #3d5170; 
            line-height: 1.8; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        
        .domain-item { 
            padding: 5px 0; 
            border-bottom: 1px solid #dfe6f0; 
        }
        
        .badge { 
            display: inline-block; 
            padding: 4px 10px; 
            background: linear-gradient(135deg, #4a6fa5 0%, #5b9bd5 100%); 
            color: #f5f7fb; 
            border-radius: 12px; 
            font-size: 0.85em; 
            margin-left: 10px; 
        }
        
        .doc-link { 
            transition: all 0.3s; 
        }
        
        .doc-link:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(91, 155, 213, 0.4); 
            opacity: 1 !important; 
        }
        
        @media (max-width: 768px) { 
            .security-level, 
            .actions { 
                flex-direction: column; 
            } 
            .language-toggle { 
                position: static; 
                margin-bottom: 20px; 
                justify-content: center; 
            } 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="lang-btn active" data-lang="de">Deutsch</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
            <h1>üõ°Ô∏è <span data-i18n="title">SEB Konfigurations-Generator</span></h1>
            <p data-i18n="subtitle">Erstellen Sie Safe Exam Browser Konfigurationen f√ºr Fokus-Modus im Unterricht</p>
            <p style="margin-top: 15px;">
                <a href="#" id="mainDocLink" class="doc-link" target="_blank" rel="noopener noreferrer" style="color: #f5f7fb; text-decoration: none; opacity: 0.95; font-weight: 600; border: 2px solid rgba(245, 247, 251, 0.5); padding: 8px 16px; border-radius: 6px; display: inline-block;">
                    üìö <span data-i18n="mainDocLink">Vollst√§ndige Anleitung</span>
                </a>
            </p>
            <div style="margin-top: 20px; padding: 12px 20px; background: rgba(45, 206, 137, 0.15); border: 2px solid rgba(45, 206, 137, 0.4); border-radius: 8px; color: #f5f7fb; font-size: 0.9em; line-height: 1.6;">
                <strong>üîí <span data-i18n="privacyTitle">Datenschutz:</span></strong> <span data-i18n="privacyText">Alle Daten werden ausschlie√ülich lokal in Ihrem Browser verarbeitet. Es werden keine Konfigurationsdaten oder Eingaben an unseren Server gesendet oder gespeichert. Nur Ihre Sprachpr√§ferenz wird lokal im Browser gespeichert.</span>
            </div>
        </div>
        <div class="content">
            <div class="section">
                <h2><span data-i18n="step1">1. Dienst ausw√§hlen</span></h2>
                <div class="preset-buttons" id="presetButtons"></div>
            </div>
            <div class="section">
                <h2><span data-i18n="step2">2. Konfigurationseinstellungen</span></h2>
                <div class="form-group">
                    <label data-i18n="startUrl">Start-URL</label>
                    <input type="url" id="startUrl" placeholder="https://www.onenote.com/notebooks">
                </div>
                <div class="form-group">
                    <label data-i18n="configName">Konfigurationsname</label>
                    <input type="text" id="configName" placeholder="Meine_Schule_OneNote">
                </div>
                <div class="form-group">
                    <label data-i18n="securityLevel">Sicherheitsstufe</label>
                    <div class="security-level" id="securityLevel"></div>
                </div>
                <div class="form-group">
                    <label data-i18n="additionalOptions">Zus√§tzliche Optionen</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowDownloads" checked>
                        <label for="allowDownloads" data-i18n="allowDownloads">Datei-Downloads erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowSpellCheck" checked>
                        <label for="allowSpellCheck" data-i18n="allowSpellCheck">Rechtschreibpr√ºfung erlauben</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showReloadButton" checked>
                        <label for="showReloadButton" data-i18n="showReloadButton">Neu-Laden-Button anzeigen</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowBackForward" checked>
                        <label for="allowBackForward" data-i18n="allowBackForward">Vor/Zur√ºck-Navigation erlauben</label>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2><span data-i18n="step3">3. Benutzerdefinierte Domains (Optional)</span></h2>
                <div class="form-group">
                    <label data-i18n="customDomainsLabel">Zus√§tzliche erlaubte Domains hinzuf√ºgen (eine pro Zeile)</label>
                    <textarea id="customDomains" data-i18n-placeholder="customDomainsPlaceholder" placeholder="beispiel.de&#10;*.schule-domain.de"></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="blockedDomainsLabel">Zus√§tzlich zu sperrende Domains (Optional, eine pro Zeile)</label>
                    <textarea id="blockedDomains" data-i18n-placeholder="blockedDomainsPlaceholder" placeholder="facebook.com&#10;instagram.com&#10;tiktok.com"></textarea>
                </div>
                <div class="info-box">
                    <h4 data-i18n="proTipTitle">üí° Profi-Tipp</h4>
                    <p data-i18n="proTipText">Verwenden Sie Wildcards (*) um alle Subdomains zu erlauben. Zum Beispiel: <code>*.microsoft.com</code> erlaubt login.microsoft.com, account.microsoft.com, usw.<br><br><strong>Hinweis:</strong> Doppelte Domains werden automatisch entfernt.</p>
                </div>
            </div>
            <div class="section">
                <h2><span data-i18n="step4">4. Vorschau & Download</span></h2>
                <div class="preview">
                    <h3><span data-i18n="allowedDomains">Erlaubte Domains</span> <span class="badge" id="domainCount">0</span></h3>
                    <div class="domain-list" id="domainPreview"></div>
                </div>
                <div class="actions">
                    <button class="btn btn-primary" id="generateBtn">
                        <span data-i18n="downloadBtn">üì• SEB Konfiguration herunterladen (.seb)</span>
                    </button>
                    <button class="btn btn-secondary" id="copyBtn">
                        <span data-i18n="copyBtn">üìã Domain-Liste kopieren</span>
                    </button>
                </div>
                <div class="info-box">
                    <h4 data-i18n="nextStepsTitle">N√§chste Schritte</h4>
                    <p data-i18n="nextStepsText">
                        1. SEB-Konfigurationsdatei herunterladen (.seb)<br>
                        2. Im SEB Config Tool √∂ffnen<br>
                        3. Einstellungen verfeinern und verschl√ºsseln<br>
                        4. Als finale .seb-Datei speichern<br>
                        5. Verschl√ºsselte Datei an Sch√ºler*innen verteilen
                    </p>
                </div>
                <div class="info-box">
                    <h4>üîß <span data-i18n="helperScriptTitle">Network Capture Helper</span></h4>
                    <p data-i18n="helperScriptText">
                        Ben√∂tigen Sie Hilfe beim Erfassen von Netzwerk-Domains? W√§hlen Sie die passende Methode f√ºr Ihr System:
                    </p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="scripts/capture-helper.ps1" download class="btn btn-secondary" style="text-decoration: none; flex: 1; min-width: 200px;">
                            <span data-i18n="downloadHelperBtn">‚¨áÔ∏è PowerShell (Windows)</span>
                        </a>
                        <button class="btn btn-secondary" id="browserHelperBtn" style="flex: 1; min-width: 200px;">
                            <span data-i18n="browserHelperBtn">üåê Browser-Methode (Alle OS)</span>
                        </button>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em;">
                        <p style="margin-bottom: 8px; font-weight: 600; color: #0B173C;">
                            <span data-i18n="helperDocsTitle">üìñ Hilfe & Anleitungen:</span>
                        </p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <a href="#" id="browserCaptureLink" class="doc-link" target="_blank" rel="noopener noreferrer" style="padding: 8px 16px; background: #d4e6f7; color: #2c3e5a; border: 2px solid #5b9bd5; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block;">
                                üåê <span data-i18n="browserCaptureLink">Browser Capture</span>
                            </a>
                            <a href="#" id="quickstartLink" class="doc-link" target="_blank" rel="noopener noreferrer" style="padding: 8px 16px; background: #d4e6f7; color: #2c3e5a; border: 2px solid #5b9bd5; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block;">
                                üöÄ <span data-i18n="quickstartLink">Schnellstart (Google Sites)</span>
                            </a>
                            <a href="#" id="quickRefLink" class="doc-link" target="_blank" rel="noopener noreferrer" style="padding: 8px 16px; background: #d4e6f7; color: #2c3e5a; border: 2px solid #5b9bd5; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block;">
                                üìã <span data-i18n="quickRefLink">Schnellreferenz</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align: center; padding: 20px; color: #8898aa; font-size: 0.85em;">
            <span id="versionInfo"></span>
        </div>
    </div>
    <script>
// ============================================================================
// TRANSLATIONS / √úBERSETZUNGEN
// ============================================================================
const TRANSLATIONS = {
    de: {
        title: "SEB Konfigurations-Generator",
        subtitle: "Erstellen Sie Safe Exam Browser Konfigurationen f√ºr Fokus-Modus im Unterricht",
        step1: "1. Dienst ausw√§hlen",
        groupNoLogin: "Ohne Anmeldung",
        groupWithLogin: "Mit Anmeldung",
        groupAllowedTools: "Erlaubte Hilfsmittel",
        selectSubject: "Fach ausw√§hlen",
        subjectGerman: "Deutsch",
        subjectEnglish: "Englisch",
        step2: "2. Konfigurationseinstellungen",
        step3: "3. Benutzerdefinierte Domains (Optional)",
        step4: "4. Vorschau & Download",
        startUrl: "Start-URL",
        configName: "Konfigurationsname",
        securityLevel: "Sicherheitsstufe",
        additionalOptions: "Zus√§tzliche Optionen",
        allowDownloads: "Datei-Downloads erlauben",
        allowSpellCheck: "Rechtschreibpr√ºfung erlauben",
        showReloadButton: "Neu-Laden-Button anzeigen",
        allowBackForward: "Vor/Zur√ºck-Navigation erlauben",
        customDomainsLabel: "Zus√§tzliche erlaubte Domains hinzuf√ºgen (eine pro Zeile)",
        customDomainsPlaceholder: "beispiel.de\n*.schule-domain.de",
        blockedDomainsLabel: "Domains sperren (Optional, nur bei Wildcards in 'Zus√§tzliche Domains')",
        blockedDomainsPlaceholder: "# Beispiel: Falls Sie *.beispiel.de erlauben\n# aber mail.beispiel.de sperren m√∂chten:\nmail.beispiel.de",
        proTipTitle: "üí° Profi-Tipp",
        proTipText: "Verwenden Sie Wildcards (*) um alle Subdomains zu erlauben. Zum Beispiel: *.microsoft.com erlaubt login.microsoft.com, account.microsoft.com, usw.<br><br><strong>Hinweis:</strong> Doppelte Domains werden automatisch entfernt.",
        allowedDomains: "Erlaubte Domains",
        downloadBtn: "üì• SEB Konfiguration herunterladen (.seb)",
        copyBtn: "üìã Domain-Liste kopieren",
        nextStepsTitle: "N√§chste Schritte",
        nextStepsText: "1. SEB-Konfigurationsdatei herunterladen (.seb)<br>2. Im SEB Config Tool √∂ffnen<br>3. Einstellungen verfeinern und verschl√ºsseln<br>4. Als finale .seb-Datei speichern<br>5. Verschl√ºsselte Datei an Sch√ºler*innen verteilen",
        helperScriptTitle: "Network Capture Helper",
        helperScriptText: "Ben√∂tigen Sie Hilfe beim Erfassen von Netzwerk-Domains? W√§hlen Sie die passende Methode f√ºr Ihr System:",
        downloadHelperBtn: "‚¨áÔ∏è PowerShell (Windows)",
        browserHelperBtn: "üåê Browser-Methode (Alle OS)",
        helperDocsTitle: "üìñ Hilfe & Anleitungen:",
        browserCaptureLink: "Browser Capture Anleitung",
        quickstartLink: "Schnellstart mit Google Sites",
        quickRefLink: "Schnellreferenz",
        mainDocLink: "Vollst√§ndige Anleitung",
        
        // Presets
        presetOnenote: "OneNote Online",
        presetOnenoteDesc: "Microsoft OneNote Web-Client",
        presetWord: "Word Online",
        presetWordDesc: "Microsoft Word Web-Client",
        presetTeams: "Microsoft Teams",
        presetTeamsDesc: "Teams Web-Client f√ºr Zusammenarbeit",
        presetGdocs: "Google Docs",
        presetGdocsDesc: "Google Workspace Dokumenteneditor",
        presetGsheets: "Google Tabellen",
        presetGsheetsDesc: "Google Workspace Tabellenkalkulation",
        presetWhiteboard: "Whiteboard.fi",
        presetWhiteboardDesc: "Kollaboratives Online-Whiteboard",
        presetPadlet: "Padlet",
        presetPadletDesc: "Digitale Pinnwand f√ºr Zusammenarbeit",
        presetKahoot: "Kahoot!",
        presetKahootDesc: "Gamifizierte Quizze und Umfragen",
        presetMentimeter: "Mentimeter",
        presetMentimeterDesc: "Live-Umfragen und interaktive Pr√§sentationen",
        presetMiro: "Miro",
        presetMiroDesc: "Digitales Whiteboard f√ºr Zusammenarbeit",
        presetSlido: "Slido",
        presetSlidoDesc: "Live Q&A und Umfragen",
        presetEtherpad: "Etherpad",
        presetEtherpadDesc: "Kollaboratives Textdokument",
        presetForms: "Microsoft Forms",
        presetFormsDesc: "Umfragen und Formulare (√∂ffentlich)",
        presetDuden: "Duden",
        presetDudenDesc: "Deutsches W√∂rterbuch und Rechtschreibung",
        presetDwds: "DWDS",
        presetDwdsDesc: "Digitales W√∂rterbuch der deutschen Sprache",
        presetOxford: "Oxford Dictionary",
        presetOxfordDesc: "Englisches Lernw√∂rterbuch",
        presetCambridge: "Cambridge Dictionary",
        presetCambridgeDesc: "Cambridge Englisch W√∂rterbuch",
        
        // Security levels
        securityRelaxed: "Locker",
        securityRelaxedDesc: "Fokus-Modus - blockiert Ablenkungen, erlaubt Flexibilit√§t",
        securityBalanced: "Ausgewogen",
        securityBalancedDesc: "Empfohlen - gutes Gleichgewicht zwischen Sicherheit und Benutzerfreundlichkeit",
        securityStrict: "Streng",
        securityStrictDesc: "Maximale Einschr√§nkungen (kann Sch√ºler frustrieren)",
        
        // Messages
        copiedMsg: "‚úì Kopiert!",
        configNamePlaceholder: "Meine_Schule_",
        
        // Privacy
        privacyTitle: "Datenschutz:",
        privacyText: "Alle Daten werden ausschlie√ülich lokal in Ihrem Browser verarbeitet. Es werden keine Konfigurationsdaten oder Eingaben an unseren Server gesendet oder gespeichert. Nur Ihre Sprachpr√§ferenz wird lokal im Browser gespeichert.",
        
        // Version info
        versionLabel: "Version",
        buildLabel: "Build"
    },
    en: {
        title: "SEB Config Generator",
        subtitle: "Create Safe Exam Browser configurations for educational focus mode",
        step1: "1. Choose Service",
        groupNoLogin: "No Login Required",
        groupWithLogin: "Login Required",
        groupAllowedTools: "Allowed Reference Tools",
        selectSubject: "Select Subject",
        subjectGerman: "German",
        subjectEnglish: "English",
        step2: "2. Configuration Settings",
        step3: "3. Custom Domains (Optional)",
        step4: "4. Preview & Download",
        startUrl: "Start URL",
        configName: "Configuration Name",
        securityLevel: "Security Level",
        additionalOptions: "Additional Options",
        allowDownloads: "Allow file downloads",
        allowSpellCheck: "Allow spell check",
        showReloadButton: "Show reload button",
        allowBackForward: "Allow back/forward navigation",
        customDomainsLabel: "Add additional allowed domains (one per line)",
        customDomainsPlaceholder: "example.com\n*.school-domain.edu",
        blockedDomainsLabel: "Block domains (Optional, only needed for wildcards in 'Additional Domains')",
        blockedDomainsPlaceholder: "# Example: If you allow *.example.com\n# but want to block mail.example.com:\nmail.example.com",
        proTipTitle: "üí° Pro Tip",
        proTipText: "Use wildcards (*) to allow all subdomains. For example: *.microsoft.com allows login.microsoft.com, account.microsoft.com, etc.<br><br><strong>Note:</strong> Duplicate domains are automatically removed.",
        allowedDomains: "Allowed Domains",
        downloadBtn: "üì• Download SEB Config (.seb)",
        copyBtn: "üìã Copy Domain List",
        nextStepsTitle: "Next Steps",
        nextStepsText: "1. Download the SEB configuration file (.seb)<br>2. Open in SEB Config Tool<br>3. Refine settings and encrypt<br>4. Save as final .seb file<br>5. Distribute encrypted file to students",
        helperScriptTitle: "Network Capture Helper",
        helperScriptText: "Need help capturing network domains? Choose the method that works for your system:",
        downloadHelperBtn: "‚¨áÔ∏è PowerShell (Windows)",
        browserHelperBtn: "üåê Browser Method (All OS)",
        helperDocsTitle: "üìñ Help & Guides:",
        browserCaptureLink: "Browser Capture Guide",
        quickstartLink: "Quick Start with Google Sites",
        quickRefLink: "Quick Reference",
        mainDocLink: "Complete Guide",
        
        // Presets
        presetOnenote: "OneNote Online",
        presetOnenoteDesc: "Microsoft OneNote web client",
        presetWord: "Word Online",
        presetWordDesc: "Microsoft Word web client",
        presetTeams: "Microsoft Teams",
        presetTeamsDesc: "Teams web client for collaboration",
        presetGdocs: "Google Docs",
        presetGdocsDesc: "Google Workspace document editor",
        presetGsheets: "Google Sheets",
        presetGsheetsDesc: "Google Workspace spreadsheet editor",
        presetWhiteboard: "Whiteboard.fi",
        presetWhiteboardDesc: "Collaborative online whiteboard",
        presetPadlet: "Padlet",
        presetPadletDesc: "Digital bulletin board for collaboration",
        presetKahoot: "Kahoot!",
        presetKahootDesc: "Gamified quizzes and polls",
        presetMentimeter: "Mentimeter",
        presetMentimeterDesc: "Live polls and interactive presentations",
        presetMiro: "Miro",
        presetMiroDesc: "Digital whiteboard for collaboration",
        presetSlido: "Slido",
        presetSlidoDesc: "Live Q&A and polls",
        presetEtherpad: "Etherpad",
        presetEtherpadDesc: "Collaborative text document",
        presetForms: "Microsoft Forms",
        presetFormsDesc: "Surveys and forms (public)",
        presetDuden: "Duden",
        presetDudenDesc: "German dictionary and spelling",
        presetDwds: "DWDS",
        presetDwdsDesc: "Digital Dictionary of German Language",
        presetOxford: "Oxford Dictionary",
        presetOxfordDesc: "English learner's dictionary",
        presetCambridge: "Cambridge Dictionary",
        presetCambridgeDesc: "Cambridge English Dictionary",
        
        // Security levels
        securityRelaxed: "Relaxed",
        securityRelaxedDesc: "Focus mode - blocks distractions but allows flexibility",
        securityBalanced: "Balanced",
        securityBalancedDesc: "Recommended - good balance of security and usability",
        securityStrict: "Strict",
        securityStrictDesc: "Maximum restrictions (may frustrate students)",
        
        // Messages
        copiedMsg: "‚úì Copied!",
        configNamePlaceholder: "My_School_",
        
        // Privacy
        privacyTitle: "Privacy:",
        privacyText: "All data is processed locally in your browser. No configuration data or inputs are sent to or stored on our server. Only your language preference is saved locally in your browser.",
        
        // Version info
        versionLabel: "Version",
        buildLabel: "Build"
    }
};

// ============================================================================
// PRESET CONFIGURATIONS
// ============================================================================
const PRESETS = {
    onenote: {
        startUrl: "https://www.onenote.com/notebooks",
        domains: ["*.microsoft.com","*.microsoftonline.com","*.msauth.net","*.msftauth.net","login.live.com","account.live.com","*.live.com","*.office.com","*.office365.com","*.officeapps.live.com","*.sharepoint.com","*.sharepointonline.com","*.onenote.com","onenote.officeapps.live.com","*.msocdn.com","*.msecnd.net","*.azureedge.net","*.windows.net","browser.events.data.microsoft.com","chc-onenote.officeapps.live.com","common.online.office.com","euc-common.online.office.com","kshch0.sharepoint.com","login.microsoftonline.com","res-1.cdn.office.net","res-1.public.onecdn.static.microsoft","wise-m.public.cdn.office.net","wise.public.cdn.office.net"],
        blockedDomains: ["outlook.office.com","outlook.office365.com","teams.microsoft.com","teams.live.com"]
    },
    word: {
        startUrl: "https://www.office.com/launch/word",
        domains: ["*.microsoft.com","*.microsoftonline.com","*.msauth.net","*.msftauth.net","login.live.com","account.live.com","*.live.com","*.office.com","*.office365.com","*.officeapps.live.com","*.sharepoint.com","*.sharepointonline.com","*.msocdn.com","*.msecnd.net","*.azureedge.net","*.windows.net","browser.events.data.microsoft.com","common.online.office.com","euc-common.online.office.com","kshch0.sharepoint.com","login.microsoftonline.com","res-1.cdn.office.net","res-1.public.onecdn.static.microsoft","wise-m.public.cdn.office.net","wise.public.cdn.office.net"],
        blockedDomains: ["outlook.office.com","outlook.office365.com","teams.microsoft.com","teams.live.com"]
    },
    whiteboard: {
        startUrl: "https://whiteboard.fi",
        domains: ["whiteboard.fi","whiteboard-storage-*.s3.*.amazonaws.com","cdn.jsdelivr.net","fonts.googleapis.com","fonts.gstatic.com"]
    },
    padlet: {
        startUrl: "https://padlet.com",
        domains: ["padlet.com","*.padlet.com","padlet.net","*.padlet.pics"]
    },
    kahoot: {
        startUrl: "https://kahoot.it",
        domains: ["kahoot.it","*.kahoot.it","kahoot.com","*.kahoot.com"]
    },
    mentimeter: {
        startUrl: "https://www.menti.com",
        domains: ["menti.com","*.menti.com","mentimeter.com","*.mentimeter.com"]
    },
    miro: {
        startUrl: "https://miro.com",
        domains: ["miro.com","*.miro.com","*.mirocdn.com"]
    },
    slido: {
        startUrl: "https://www.slido.com",
        domains: ["slido.com","*.slido.com","*.sli.do"]
    },
    etherpad: {
        startUrl: "https://etherpad.org",
        domains: ["etherpad.org","*.etherpad.org"]
    },
    forms: {
        startUrl: "https://forms.office.com",
        domains: ["forms.office.com","*.forms.office.com","*.microsoft.com","*.microsoftonline.com","*.office.com","*.office365.com","*.msocdn.com","*.msecnd.net","*.azureedge.net"]
    },
    duden: {
        startUrl: "https://www.duden.de",
        domains: ["duden.de","*.duden.de","*.doubleclick.net","*.googletagmanager.com","*.stroeerdigitalgroup.de","*.taboola.com","*.yieldlove.com","mitself.net"]
    },
    dwds: {
        startUrl: "https://www.dwds.de",
        domains: ["dwds.de","*.dwds.de"]
    },
    oxford: {
        startUrl: "https://www.oxfordlearnersdictionaries.com",
        domains: ["oxfordlearnersdictionaries.com","*.oxfordlearnersdictionaries.com","*.oup.com","*.cookielaw.org","*.doubleclick.net","*.google-analytics.com","*.google.com","*.googletagmanager.com","*.onetrust.com","*.polarbyte.com","html-load.com"]
    },
    cambridge: {
        startUrl: "https://dictionary.cambridge.org",
        domains: ["dictionary.cambridge.org","*.cambridge.org"]
    }
};

const PRESET_GROUPS = {
    noLogin: ['whiteboard', 'kahoot', 'mentimeter', 'slido', 'forms', 'padlet', 'miro', 'etherpad'],
    withLogin: ['onenote', 'word'],
    allowedTools: {
        german: ['duden', 'dwds'],
        english: ['oxford', 'cambridge']
    }
};

const SECURITY_LEVELS = {
    relaxed: {
        settings: {allowSwitchToApplications:false,allowQuit:true,browserViewMode:0,enableBrowserWindowToolbar:true,showMenuBar:false}
    },
    balanced: {
        settings: {allowSwitchToApplications:false,allowQuit:true,browserViewMode:0,enableBrowserWindowToolbar:true,showMenuBar:false}
    },
    strict: {
        settings: {allowSwitchToApplications:false,allowQuit:false,browserViewMode:1,enableBrowserWindowToolbar:false,showMenuBar:false}
    }
};

// ============================================================================
// VERSION & BUILD INFO
// ============================================================================
const APP_VERSION = 'v0.';
const BUILD_DATE = new Date('2025-11-09T23:28:00'); // Format: YYYY-MM-DDTHH:mm:ss

function formatBuildDate(lang) {
    const day = String(BUILD_DATE.getDate()).padStart(2, '0');
    const month = String(BUILD_DATE.getMonth() + 1).padStart(2, '0');
    const year = BUILD_DATE.getFullYear();
    const hours = String(BUILD_DATE.getHours()).padStart(2, '0');
    const minutes = String(BUILD_DATE.getMinutes()).padStart(2, '0');
    
    if (lang === 'de') {
        return `${day}.${month}.${year} ${hours}:${minutes}`;
    } else {
        return `${day}/${month}/${year} ${hours}:${minutes}`;
    }
}

// ============================================================================
// STATE
// ============================================================================
let currentLang = 'de';
let selectedPresets = []; // Start with no preset selected - user must choose
let currentSecurityLevel = 'balanced';
let currentSelectedSubject = ''; // Track selected subject for allowed tools

// ============================================================================
// LANGUAGE MANAGEMENT
// ============================================================================
function setLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (TRANSLATIONS[lang][key]) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                el.placeholder = TRANSLATIONS[lang][key];
            } else {
                el.innerHTML = TRANSLATIONS[lang][key];
            }
        }
    });
    
    // Update placeholder attributes
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (TRANSLATIONS[lang][key]) {
            el.placeholder = TRANSLATIONS[lang][key];
        }
    });
    
    // Update language toggle buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });
    
    // Update documentation links based on language
    updateDocLinks(lang);
    
    // Update version info
    updateVersionInfo(lang);
    
    // Re-render dynamic content
    renderPresets();
    renderSecurityLevels();
    
    // Save language preference
    localStorage.setItem('sebConfigLang', lang);
}

function updateVersionInfo(lang) {
    const versionInfo = document.getElementById('versionInfo');
    if (versionInfo) {
        const versionLabel = t('versionLabel');
        const buildLabel = t('buildLabel');
        const buildDate = formatBuildDate(lang);
        versionInfo.innerHTML = `${versionLabel}: ${APP_VERSION} | ${buildLabel}: ${buildDate}`;
    }
}

function updateDocLinks(lang) {
    // Main documentation link in header
    const mainDocLink = document.getElementById('mainDocLink');
    if (mainDocLink) {
        if (lang === 'de') {
            mainDocLink.href = 'docs/de/SCHNELLSTART_ANLEITUNG.md';
        } else {
            mainDocLink.href = 'docs/en/TEACHER_GUIDE.md';
        }
    }
    
    // Browser capture guide
    const browserCaptureLink = document.getElementById('browserCaptureLink');
    if (browserCaptureLink) {
        if (lang === 'de') {
            browserCaptureLink.href = 'docs/de/BROWSER_CAPTURE_ANLEITUNG.md';
        } else {
            browserCaptureLink.href = 'docs/en/BROWSER_CAPTURE_GUIDE.md';
        }
    }
    
    // Quickstart/Sites guide
    const quickstartLink = document.getElementById('quickstartLink');
    if (quickstartLink) {
        if (lang === 'de') {
            quickstartLink.href = 'docs/de/SCHNELLSTART_ANLEITUNG.md';
        } else {
            quickstartLink.href = 'docs/en/TEACHER_GUIDE.md';
        }
    }
    
    // Quick reference
    const quickRefLink = document.getElementById('quickRefLink');
    if (quickRefLink) {
        if (lang === 'de') {
            quickRefLink.href = 'docs/de/SCHNELLREFERENZ.txt';
        } else {
            quickRefLink.href = 'docs/en/QUICK_REFERENCE.txt';
        }
    }
}

function t(key) {
    return TRANSLATIONS[currentLang][key] || key;
}

// ============================================================================
// UI RENDERING
// ============================================================================
function renderPresets() {
    const container = document.getElementById('presetButtons');
    container.innerHTML = '';
    
    // Group 1: No Login Required
    const group1Title = document.createElement('h3');
    group1Title.style.cssText = 'color: #2c3e5a; margin: 20px 0 15px 0; font-size: 1.1em; grid-column: 1 / -1;';
    group1Title.innerHTML = `üåê ${t('groupNoLogin')}`;
    container.appendChild(group1Title);
    
    PRESET_GROUPS.noLogin.forEach(key => {
        const btn = document.createElement('button');
        btn.className = `preset-btn ${selectedPresets.includes(key) ? 'active' : ''}`;
        btn.innerHTML = `
            <h3>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1))}</h3>
            <p>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        btn.onclick = () => togglePreset(key);
        container.appendChild(btn);
    });
    
    // Group 2: Login Required
    const group2Title = document.createElement('h3');
    group2Title.style.cssText = 'color: #2c3e5a; margin: 30px 0 15px 0; font-size: 1.1em; grid-column: 1 / -1;';
    group2Title.innerHTML = `üîê ${t('groupWithLogin')}`;
    container.appendChild(group2Title);
    
    PRESET_GROUPS.withLogin.forEach(key => {
        const btn = document.createElement('button');
        btn.className = `preset-btn ${selectedPresets.includes(key) ? 'active' : ''}`;
        btn.innerHTML = `
            <h3>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1))}</h3>
            <p>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        btn.onclick = () => togglePreset(key);
        container.appendChild(btn);
    });
    
    // Group 3: Allowed Tools (with subject selection)
    const group3Title = document.createElement('h3');
    group3Title.style.cssText = 'color: #2c3e5a; margin: 30px 0 15px 0; font-size: 1.1em; grid-column: 1 / -1;';
    group3Title.innerHTML = `üìö ${t('groupAllowedTools')}`;
    container.appendChild(group3Title);
    
    // Subject selector
    const subjectSelector = document.createElement('div');
    subjectSelector.style.cssText = 'grid-column: 1 / -1; margin-bottom: 15px;';
    subjectSelector.innerHTML = `
        <label style="color: #2c3e5a; font-weight: 600; display: block; margin-bottom: 8px;">${t('selectSubject')}:</label>
        <select id="subjectSelect" style="width: 100%; padding: 10px; border: 2px solid #dfe6f0; border-radius: 8px; background: #f5f7fb; color: #2c3e5a; font-size: 1em; cursor: pointer;">
            <option value="">-- ${t('selectSubject')} --</option>
            <option value="german">${t('subjectGerman')}</option>
            <option value="english">${t('subjectEnglish')}</option>
        </select>
    `;
    container.appendChild(subjectSelector);
    
    // Tools container (initially hidden)
    const toolsContainer = document.createElement('div');
    toolsContainer.id = 'allowedToolsContainer';
    toolsContainer.style.cssText = 'grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;';
    container.appendChild(toolsContainer);
    
    // Add event listener to subject selector and restore previous selection
    setTimeout(() => {
        const select = document.getElementById('subjectSelect');
        if (select) {
            // Restore previously selected subject
            if (currentSelectedSubject) {
                select.value = currentSelectedSubject;
                renderAllowedTools(currentSelectedSubject);
            }
            select.addEventListener('change', (e) => renderAllowedTools(e.target.value));
        }
    }, 0);
}

function renderAllowedTools(subject) {
    const container = document.getElementById('allowedToolsContainer');
    if (!container) return;
    
    // Store the selected subject
    currentSelectedSubject = subject;
    
    container.innerHTML = '';
    
    if (!subject || !PRESET_GROUPS.allowedTools[subject]) return;
    
    PRESET_GROUPS.allowedTools[subject].forEach(key => {
        const btn = document.createElement('button');
        btn.className = `preset-btn ${selectedPresets.includes(key) ? 'active' : ''}`;
        btn.innerHTML = `
            <h3>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1))}</h3>
            <p>${t('preset' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        btn.onclick = () => togglePreset(key);
        container.appendChild(btn);
    });
}

function renderSecurityLevels() {
    const container = document.getElementById('securityLevel');
    container.innerHTML = '';
    
    ['relaxed', 'balanced', 'strict'].forEach(key => {
        const div = document.createElement('div');
        div.className = `security-option ${key === currentSecurityLevel ? 'active' : ''}`;
        div.innerHTML = `
            <h4>${t('security' + key.charAt(0).toUpperCase() + key.slice(1))}</h4>
            <p>${t('security' + key.charAt(0).toUpperCase() + key.slice(1) + 'Desc')}</p>
        `;
        div.onclick = () => selectSecurityLevel(key);
        container.appendChild(div);
    });
}

function togglePreset(key) {
    // Check if this is an allowed tool (Hilfsmittel)
    const isAllowedTool = Object.values(PRESET_GROUPS.allowedTools).flat().includes(key);
    
    const index = selectedPresets.indexOf(key);
    if (index === -1) {
        selectedPresets.push(key);
    } else {
        selectedPresets.splice(index, 1);
    }
    
    // Ensure at least one main preset is selected when deselecting (not counting allowed tools)
    const mainPresets = selectedPresets.filter(p => !Object.values(PRESET_GROUPS.allowedTools).flat().includes(p));
    if (mainPresets.length === 0 && !isAllowedTool && index !== -1) {
        // Only restore if we were deselecting (index !== -1)
        selectedPresets = [key];
    }
    
    // Update start URL to first selected main preset
    const firstMainPreset = selectedPresets.find(p => !Object.values(PRESET_GROUPS.allowedTools).flat().includes(p));
    if (firstMainPreset && PRESETS[firstMainPreset]) {
        document.getElementById('startUrl').value = PRESETS[firstMainPreset].startUrl;
    } else {
        document.getElementById('startUrl').value = '';
    }
    
    // Update config name
    const mainPresetsForName = selectedPresets.filter(p => !Object.values(PRESET_GROUPS.allowedTools).flat().includes(p));
    if (mainPresetsForName.length === 1) {
        const presetName = t('preset' + mainPresetsForName[0].charAt(0).toUpperCase() + mainPresetsForName[0].slice(1));
        document.getElementById('configName').value = `${presetName.replace(/\s+/g, '_')}_Config`;
    } else if (mainPresetsForName.length > 1) {
        document.getElementById('configName').value = `Multi_Service_Config`;
    } else {
        document.getElementById('configName').value = '';
    }
    
    renderPresets();
    updatePreview();
}

function selectSecurityLevel(key) {
    currentSecurityLevel = key;
    renderSecurityLevels();
}

function getAllDomains() {
    // Combine domains from all selected presets
    const presetDomains = [];
    selectedPresets.forEach(presetKey => {
        if (PRESETS[presetKey]) {
            presetDomains.push(...PRESETS[presetKey].domains);
        }
    });
    
    const customDomains = document.getElementById('customDomains').value
        .split('\n')
        .map(d => d.trim())
        .filter(d => d && !d.startsWith('#'));
    
    // Combine and remove duplicates (case-insensitive)
    const allDomains = [...presetDomains, ...customDomains];
    const uniqueDomains = [];
    const seen = new Set();
    
    allDomains.forEach(domain => {
        const lowerDomain = domain.toLowerCase();
        if (!seen.has(lowerDomain)) {
            seen.add(lowerDomain);
            uniqueDomains.push(domain);
        }
    });
    
    return uniqueDomains;
}

function updatePreview() {
    const presetDomains = [];
    selectedPresets.forEach(presetKey => {
        if (PRESETS[presetKey]) {
            presetDomains.push(...PRESETS[presetKey].domains);
        }
    });
    
    const customDomains = document.getElementById('customDomains').value
        .split('\n')
        .map(d => d.trim())
        .filter(d => d && !d.startsWith('#'));
    
    const allDomainsBeforeDedup = [...presetDomains, ...customDomains];
    const domains = getAllDomains();
    const duplicatesRemoved = allDomainsBeforeDedup.length - domains.length;
    
    const container = document.getElementById('domainPreview');
    document.getElementById('domainCount').textContent = domains.length;
    
    // Show selected services info
    let html = '';
    if (selectedPresets.length > 1) {
        const serviceNames = selectedPresets.map(key => 
            t('preset' + key.charAt(0).toUpperCase() + key.slice(1))
        ).join(', ');
        const infoText = currentLang === 'de'
            ? `‚úì Ausgew√§hlte Dienste: ${serviceNames}`
            : `‚úì Selected services: ${serviceNames}`;
        html += `<div style="background:#d4edda;border-left:4px solid #28a745;padding:10px;margin-bottom:10px;border-radius:4px;color:#155724;font-size:0.9em;">${infoText}</div>`;
    }
    
    html += domains
        .map(domain => `<div class="domain-item">‚úì ${domain}</div>`)
        .join('');
    
    // Show blocked domains if any
    const blockedDomains = [];
    selectedPresets.forEach(presetKey => {
        const preset = PRESETS[presetKey];
        if (preset && preset.blockedDomains) {
            blockedDomains.push(...preset.blockedDomains);
        }
    });
    
    // Add custom blocked domains from user input
    const customBlockedInput = document.getElementById('blockedDomains').value;
    if (customBlockedInput.trim()) {
        const customBlockedDomains = customBlockedInput
            .split('\n')
            .map(domain => domain.trim())
            .filter(domain => domain && !domain.startsWith('#'));
        blockedDomains.push(...customBlockedDomains);
    }
    
    if (blockedDomains.length > 0) {
        const blockedTitle = currentLang === 'de' 
            ? 'üö´ Blockierte Domains (explizit gesperrt)'
            : 'üö´ Blocked Domains (explicitly denied)';
        html += `<div style="margin-top:20px;padding-top:15px;border-top:2px solid #dfe6f0;"><strong style="color:#2c3e5a;">${blockedTitle}</strong></div>`;
        html += blockedDomains
            .map(domain => `<div class="domain-item" style="color:#dc3545;">‚úó ${domain}</div>`)
            .join('');
    }
    
    // Show warning if duplicates were removed
    if (duplicatesRemoved > 0) {
        const warningText = currentLang === 'de' 
            ? `‚ö†Ô∏è ${duplicatesRemoved} doppelte Domain(s) wurden entfernt`
            : `‚ö†Ô∏è ${duplicatesRemoved} duplicate domain(s) removed`;
        html = `<div style="background:#fff3cd;border-left:4px solid #ffc107;padding:10px;margin-bottom:10px;border-radius:4px;color:#856404;font-size:0.9em;">${warningText}</div>` + html;
    }
    
    container.innerHTML = html;
}

// ============================================================================
// CONFIG GENERATION - XML (PLIST)
// ============================================================================
function generateConfigXML() {
    const securitySettings = SECURITY_LEVELS[currentSecurityLevel].settings;
    const domains = getAllDomains();
    const startUrl = document.getElementById('startUrl').value;
    
    // Build URL filter rules XML (whitelist - action: 1)
    let urlFilterRulesXML = '';
    domains.forEach(domain => {
        urlFilterRulesXML += `\t\t<dict>
\t\t\t<key>action</key>
\t\t\t<integer>1</integer>
\t\t\t<key>active</key>
\t\t\t<true/>
\t\t\t<key>expression</key>
\t\t\t<string>${escapeXML(domain)}</string>
\t\t\t<key>regex</key>
\t\t\t<false/>
\t\t</dict>
`;
    });
    
    // Add blocked domains (blacklist - action: 0) from selected presets
    selectedPresets.forEach(presetKey => {
        const preset = PRESETS[presetKey];
        if (preset && preset.blockedDomains) {
            preset.blockedDomains.forEach(domain => {
                urlFilterRulesXML += `\t\t<dict>
\t\t\t<key>action</key>
\t\t\t<integer>0</integer>
\t\t\t<key>active</key>
\t\t\t<true/>
\t\t\t<key>expression</key>
\t\t\t<string>${escapeXML(domain)}</string>
\t\t\t<key>regex</key>
\t\t\t<false/>
\t\t</dict>
`;
            });
        }
    });
    
    // Add custom blocked domains (blacklist - action: 0) from user input
    const customBlockedInput = document.getElementById('blockedDomains').value;
    if (customBlockedInput.trim()) {
        const customBlockedDomains = customBlockedInput
            .split('\n')
            .map(domain => domain.trim())
            .filter(domain => domain && !domain.startsWith('#'));
        
        customBlockedDomains.forEach(domain => {
            urlFilterRulesXML += `\t\t<dict>
\t\t\t<key>action</key>
\t\t\t<integer>0</integer>
\t\t\t<key>active</key>
\t\t\t<true/>
\t\t\t<key>expression</key>
\t\t\t<string>${escapeXML(domain)}</string>
\t\t\t<key>regex</key>
\t\t\t<false/>
\t\t</dict>
`;
        });
    }
    
    // Generate complete plist XML with version info
    const buildDateFormatted = formatBuildDate('en'); // Use international format for file
    const xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<!-- Generated by SEB Config Generator ${APP_VERSION} (Build: ${buildDateFormatted}) -->
<!-- https://github.com/markuskiller/SEBConfigGenerator -->
<plist version="1.0">
<dict>
\t<key>URLFilterEnable</key>
\t<${urlFilterRulesXML.length > 0 ? 'true' : 'false'}/>
\t<key>URLFilterEnableContentFilter</key>
\t<false/>
\t<key>URLFilterRules</key>
\t<array>
${urlFilterRulesXML}\t</array>
\t<key>allowAudioCapture</key>
\t<false/>
\t<key>allowBrowsingBackForward</key>
\t<${document.getElementById('allowBackForward').checked ? 'true' : 'false'}/>
\t<key>allowDictionaryLookup</key>
\t<false/>
\t<key>allowDownUploads</key>
\t<${document.getElementById('allowDownloads').checked ? 'true' : 'false'}/>
\t<key>allowDownloads</key>
\t<${document.getElementById('allowDownloads').checked ? 'true' : 'false'}/>
\t<key>allowFlashFullscreen</key>
\t<false/>
\t<key>allowPreferencesWindow</key>
\t<false/>
\t<key>allowQuit</key>
\t<${securitySettings.allowQuit ? 'true' : 'false'}/>
\t<key>allowSpellCheck</key>
\t<${document.getElementById('allowSpellCheck').checked ? 'true' : 'false'}/>
\t<key>allowSwitchToApplications</key>
\t<${securitySettings.allowSwitchToApplications ? 'true' : 'false'}/>
\t<key>allowVideoCapture</key>
\t<false/>
\t<key>browserViewMode</key>
\t<integer>${securitySettings.browserViewMode}</integer>
\t<key>browserWindowAllowReload</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>enableBrowserWindowToolbar</key>
\t<${securitySettings.enableBrowserWindowToolbar ? 'true' : 'false'}/>
\t<key>enablePlugIns</key>
\t<true/>
\t<key>enableSebBrowser</key>
\t<true/>
\t<key>enableZoomPage</key>
\t<true/>
\t<key>enableZoomText</key>
\t<true/>
\t<key>examSessionClearCookiesOnEnd</key>
\t<true/>
\t<key>examSessionClearCookiesOnStart</key>
\t<true/>
\t<key>newBrowserWindowAllowReload</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>originatorVersion</key>
\t<string>SEB_Config_Generator_${APP_VERSION}_${buildDateFormatted.replace(/[/:]/g, '-').replace(/ /g, '_')}</string>
\t<key>removeBrowserProfile</key>
\t<false/>
\t<key>showMenuBar</key>
\t<${securitySettings.showMenuBar ? 'true' : 'false'}/>
\t<key>showReloadButton</key>
\t<${document.getElementById('showReloadButton').checked ? 'true' : 'false'}/>
\t<key>startURL</key>
\t<string>${escapeXML(startUrl)}</string>
\t<key>touchOptimized</key>
\t<false/>
</dict>
</plist>`;
    
    return xml;
}

function escapeXML(str) {
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&apos;');
}

function downloadConfig() {
    const configXML = generateConfigXML();
    const configName = document.getElementById('configName').value || 'SEB_Config';
    const blob = new Blob([configXML], { type: 'application/xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${configName}.seb`;
    a.click();
    URL.revokeObjectURL(url);
}

function copyDomains() {
    const domains = getAllDomains().join('\n');
    navigator.clipboard.writeText(domains).then(() => {
        const btn = document.getElementById('copyBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = t('copiedMsg');
        setTimeout(() => {
            btn.innerHTML = originalText;
        }, 2000);
    });
}

// ============================================================================
// BROWSER HELPER FUNCTIONALITY
// ============================================================================
function showBrowserHelper() {
    // Get current preset domains for filtering
    const presetDomains = [];
    selectedPresets.forEach(presetKey => {
        if (PRESETS[presetKey]) {
            presetDomains.push(...PRESETS[presetKey].domains);
        }
    });
    const presetDomainsJSON = JSON.stringify([...new Set(presetDomains)]);
    
    const script = `// SEB Domain Capture Script - Run AFTER fully logging in and using the service
(function() {
    console.clear();
    console.log('%cüõ°Ô∏è SEB Domain Capture', 'font-size:20px; color:#5e72e4; font-weight:bold;');
    console.log('%c' + '='.repeat(60), 'color:#ccc;');
    
    // Preset domains from current configuration
    const presetDomains = ${presetDomainsJSON};
    const presetSet = new Set(presetDomains.map(d => d.toLowerCase()));
    
    const allDomains = new Set();
    
    // Capture all network requests
    performance.getEntries().forEach(entry => {
        try {
            const url = new URL(entry.name);
            if (url.hostname && !url.hostname.match(/^(localhost|127\\\\.0\\\\.0\\\\.1|::1)$/)) {
                allDomains.add(url.hostname.toLowerCase());
            }
        } catch (e) {}
    });
    
    // Filter out domains already in preset
    const newDomains = [...allDomains].filter(domain => {
        // Check exact match
        if (presetSet.has(domain)) return false;
        
        // Check if domain matches any preset wildcard
        for (let preset of presetDomains) {
            if (preset.startsWith('*.')) {
                const suffix = preset.substring(1); // Remove *
                if (domain.endsWith(suffix) || domain === suffix.substring(1)) {
                    return false;
                }
            }
        }
        return true;
    }).sort();
    
    console.log(\`\\nüìä Total captured: \${allDomains.size} domains\`);
    console.log(\`‚úì Already in preset: \${allDomains.size - newDomains.length} domains\`);
    console.log(\`üÜï New domains found: \${newDomains.length} domains\\n\`);
    
    if (newDomains.length === 0) {
        console.log('%c‚úÖ NO NEW DOMAINS NEEDED!', 'color:#2dce89; font-size:18px; font-weight:bold;');
        console.log('%cAll captured domains are already in the preset.', 'color:#666;');
        console.log('\\n' + '='.repeat(60) + '\\n');
        return;
    }
    
    // Generate wildcards for new domains only
    const wildcards = new Set();
    newDomains.forEach(domain => {
        const parts = domain.split('.');
        if (parts.length > 2) {
            wildcards.add('*.' + parts.slice(-2).join('.'));
        } else {
            wildcards.add(domain);
        }
    });
    
    const output = [...wildcards].sort().join('\\n');
    
    console.log('='.repeat(60));
    console.log('%cüìã COPY THESE NEW DOMAINS:', 'color:#f5365c; font-size:16px; font-weight:bold;');
    console.log('='.repeat(60) + '\\n');
    console.log(output);
    console.log('\\n' + '='.repeat(60));
    
    console.log('\\n%cüìù HOW TO USE:', 'color:#5e72e4; font-weight:bold;');
    console.log('  1. Select the domain list above (click & drag)');
    console.log('  2. Right-click ‚Üí Copy (or Ctrl+C / Cmd+C)');
    console.log('  3. Paste into "Custom Domains" field in SEB Generator');
    console.log('\\n' + '='.repeat(60) + '\\n');
})();`;

    const bookmarklet = `javascript:(function(){const domains=new Set();performance.getEntries().forEach(e=>{try{const u=new URL(e.name);if(u.hostname&&!u.hostname.match(/^(localhost|127\\\\.0\\\\.0\\\\.1|::1)$/)){domains.add(u.hostname)}}catch(err){}});const sorted=[...domains].sort();let output='SEB Domain Capture\\n'+'='.repeat(50)+'\\n\\n';output+='Total domains: '+sorted.length+'\\n\\n';output+='DOMAINS:\\n'+'-'.repeat(50)+'\\n';output+=sorted.join('\\n')+'\\n';output+='-'.repeat(50)+'\\n\\n';output+='Wildcards (recommended):\\n'+'-'.repeat(50)+'\\n';const wildcards=new Set();sorted.forEach(d=>{const parts=d.split('.');if(parts.length>2){wildcards.add('*.'+parts.slice(-2).join('.'))}else{wildcards.add(d)}});output+=[...wildcards].sort().join('\\n');const modal=document.createElement('div');modal.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:999999;max-width:600px;max-height:80vh;overflow:auto;font-family:monospace;';const pre=document.createElement('pre');pre.textContent=output;pre.style.cssText='background:#f5f5f5;padding:15px;border-radius:6px;overflow:auto;max-height:400px;font-size:12px;';const btnContainer=document.createElement('div');btnContainer.style.cssText='margin-top:20px;display:flex;gap:10px;';const copyBtn=document.createElement('button');copyBtn.textContent='üìã Copy';copyBtn.style.cssText='padding:12px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;flex:1;';copyBtn.onclick=()=>{navigator.clipboard.writeText(sorted.join('\\n')).then(()=>{copyBtn.textContent='‚úì Copied!';setTimeout(()=>copyBtn.textContent='üìã Copy',2000)})};const closeBtn=document.createElement('button');closeBtn.textContent='‚úï';closeBtn.style.cssText='padding:12px 20px;background:#e9ecef;color:#32325d;border:none;border-radius:6px;cursor:pointer;font-weight:600;';closeBtn.onclick=()=>modal.remove();btnContainer.appendChild(copyBtn);btnContainer.appendChild(closeBtn);modal.appendChild(pre);modal.appendChild(btnContainer);document.body.appendChild(modal)})();`;

    const instructions = currentLang === 'de' 
        ? {
            title: 'üåê Browser-basierte Domain-Erfassung',
            method1: 'Methode 1: Console Script (Empfohlen)',
            method1Steps: [
                '‚ö†Ô∏è WICHTIG: Zuerst Browser-Cache leeren (Strg+Shift+Entf / Cmd+Shift+Entf)',
                '1. √ñffnen Sie den Dienst (z.B. OneNote) in einem neuen Tab',
                '2. Nutzen Sie den Dienst vollst√§ndig (einloggen, arbeiten)',
                '3. Dr√ºcken Sie F12 um DevTools zu √∂ffnen',
                '4. Gehen Sie zum Tab "Konsole"',
                '5. Kopieren Sie das Skript unten und f√ºgen Sie es ein',
                '6. Dr√ºcken Sie Enter',
                '7. Zeigt nur NEUE Domains (nicht bereits in Preset)',
                '8. W√§hlen Sie die Domains aus und kopieren Sie sie manuell',
                '9. F√ºgen Sie sie ins Feld "Benutzerdefinierte Domains" ein'
            ],
            method2: 'Methode 2: Bookmarklet',
            method2Steps: [
                '1. Erstellen Sie ein neues Lesezeichen',
                '2. Kopieren Sie den Bookmarklet-Code unten',
                '3. F√ºgen Sie ihn als URL des Lesezeichens ein',
                '4. √ñffnen Sie Ihren Dienst und klicken Sie das Lesezeichen',
                '5. Ein Dialog zeigt alle Domains'
            ],
            consoleLabel: 'Console Script:',
            bookmarkletLabel: 'Bookmarklet Code:',
            copyScript: 'üìã Script kopieren',
            copyBookmarklet: 'üìã Bookmarklet kopieren',
            fullGuide: 'üìñ Vollst√§ndige Anleitung',
            close: 'Schlie√üen'
        }
        : {
            title: 'üåê Browser-Based Domain Capture',
            method1: 'Method 1: Console Script (Recommended)',
            method1Steps: [
                '‚ö†Ô∏è IMPORTANT: First clear browser cache (Ctrl+Shift+Delete / Cmd+Shift+Delete)',
                '1. Open your service (e.g., OneNote) in a new tab',
                '2. Use the service fully (login, work normally)',
                '3. Press F12 to open DevTools',
                '4. Go to the "Console" tab',
                '5. Copy the script below and paste it',
                '6. Press Enter',
                '7. Shows only NEW domains (not already in preset)',
                '8. Select the domains and copy them manually',
                '9. Paste them into the "Custom Domains" field'
            ],
            method2: 'Method 2: Bookmarklet',
            method2Steps: [
                '1. Create a new bookmark',
                '2. Copy the bookmarklet code below',
                '3. Paste it as the bookmark URL',
                '4. Open your service and click the bookmark',
                '5. A dialog will show all domains'
            ],
            consoleLabel: 'Console Script:',
            bookmarkletLabel: 'Bookmarklet Code:',
            copyScript: 'üìã Copy Script',
            copyBookmarklet: 'üìã Copy Bookmarklet',
            fullGuide: 'üìñ Full Guide',
            close: 'Close'
        };

    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;';
    
    const content = document.createElement('div');
    content.style.cssText = 'background:white;border-radius:12px;padding:30px;max-width:800px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);';
    
    content.innerHTML = `
        <h2 style="color:#5e72e4;margin-bottom:20px;">${instructions.title}</h2>
        
        <div style="background:#f0f3ff;padding:20px;border-radius:8px;margin-bottom:20px;">
            <h3 style="color:#5e72e4;margin-bottom:15px;">${instructions.method1}</h3>
            ${instructions.method1Steps.map(step => `<div style="margin:8px 0;">${step}</div>`).join('')}
            
            <div style="margin-top:15px;">
                <label style="font-weight:600;color:#32325d;display:block;margin-bottom:8px;">${instructions.consoleLabel}</label>
                <textarea readonly style="width:100%;height:120px;font-family:monospace;font-size:12px;padding:10px;border:2px solid #e9ecef;border-radius:6px;resize:vertical;">${script}</textarea>
                <button id="copyScriptBtn" style="margin-top:10px;padding:10px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.copyScript}</button>
            </div>
        </div>
        
        <div style="background:#f7f8fc;padding:20px;border-radius:8px;margin-bottom:20px;">
            <h3 style="color:#5e72e4;margin-bottom:15px;">${instructions.method2}</h3>
            ${instructions.method2Steps.map(step => `<div style="margin:8px 0;">${step}</div>`).join('')}
            
            <div style="margin-top:15px;">
                <label style="font-weight:600;color:#32325d;display:block;margin-bottom:8px;">${instructions.bookmarkletLabel}</label>
                <textarea readonly style="width:100%;height:100px;font-family:monospace;font-size:11px;padding:10px;border:2px solid #e9ecef;border-radius:6px;resize:vertical;">${bookmarklet}</textarea>
                <button id="copyBookmarkletBtn" style="margin-top:10px;padding:10px 20px;background:#5e72e4;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.copyBookmarklet}</button>
            </div>
        </div>
        
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:20px;">
            <a href="docs/${currentLang}/BROWSER_CAPTURE_${currentLang === 'de' ? 'ANLEITUNG' : 'GUIDE'}.md" target="_blank" rel="noopener noreferrer" style="padding:12px 24px;background:#f7f8fc;color:#5e72e4;border:2px solid #e9ecef;border-radius:6px;text-decoration:none;font-weight:600;">${instructions.fullGuide}</a>
            <button id="closeBrowserHelperBtn" style="padding:12px 24px;background:#e9ecef;color:#32325d;border:none;border-radius:6px;cursor:pointer;font-weight:600;">${instructions.close}</button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Event listeners
    document.getElementById('copyScriptBtn').addEventListener('click', () => {
        navigator.clipboard.writeText(script);
        const btn = document.getElementById('copyScriptBtn');
        const original = btn.textContent;
        btn.textContent = '‚úì ' + (currentLang === 'de' ? 'Kopiert!' : 'Copied!');
        setTimeout(() => btn.textContent = original, 2000);
    });
    
    document.getElementById('copyBookmarkletBtn').addEventListener('click', () => {
        navigator.clipboard.writeText(bookmarklet);
        const btn = document.getElementById('copyBookmarkletBtn');
        const original = btn.textContent;
        btn.textContent = '‚úì ' + (currentLang === 'de' ? 'Kopiert!' : 'Copied!');
        setTimeout(() => btn.textContent = original, 2000);
    });
    
    document.getElementById('closeBrowserHelperBtn').addEventListener('click', () => {
        modal.remove();
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
}

// ============================================================================
// EVENT LISTENERS
// ============================================================================
function attachEventListeners() {
    // Language toggle
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
    });
    
    // Main actions
    document.getElementById('generateBtn').addEventListener('click', downloadConfig);
    document.getElementById('copyBtn').addEventListener('click', copyDomains);
    document.getElementById('customDomains').addEventListener('input', updatePreview);
    document.getElementById('blockedDomains').addEventListener('input', updatePreview);
    document.getElementById('startUrl').addEventListener('input', updatePreview);
    
    // Browser helper
    document.getElementById('browserHelperBtn').addEventListener('click', showBrowserHelper);
}

// ============================================================================
// INITIALIZATION
// ============================================================================
function init() {
    // Load saved language preference or default to German
    const savedLang = localStorage.getItem('sebConfigLang') || 'de';
    setLanguage(savedLang);
    
    attachEventListeners();
    updatePreview();
}

// Start the application
init();
    </script>
</body>
</html>
