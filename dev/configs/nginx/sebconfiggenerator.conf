# ============================================================================
# Nginx Configuration for SEB Config Generator
# ============================================================================
# This file configures HTTP security headers for Nginx web servers.
# Include this file in your server block or create a new server block.
#
# Requirements:
# - Nginx 1.18+ (headers module is built-in)
#
# Version: v0.21.0a4
# Updated: 2025-11-15
# ============================================================================

# ----------------------------------------------------------------------------
# Example Server Block Configuration
# ----------------------------------------------------------------------------
# This is a complete example of how to configure Nginx for the application.
# Adjust server_name, root path, and SSL certificates as needed.
# ----------------------------------------------------------------------------

server {
    # ----------------------------------------------------------------------------
    # Basic Server Configuration
    # ----------------------------------------------------------------------------
    listen 80;
    listen [::]:80;
    server_name sebconfig.example.com;  # Change to your domain
    
    root /var/www/sebconfig;  # Change to your web root
    index index.html;
    
    # ----------------------------------------------------------------------------
    # Logging Configuration
    # ----------------------------------------------------------------------------
    access_log /var/log/nginx/sebconfig_access.log;
    error_log /var/log/nginx/sebconfig_error.log;
    
    # ----------------------------------------------------------------------------
    # Content Security Policy (CSP)
    # ----------------------------------------------------------------------------
    # Prevents XSS attacks by controlling which resources can be loaded.
    # This strict policy allows only same-origin resources.
    #
    # Directives explained:
    # - default-src 'self'        : Default fallback for all resource types
    # - script-src 'self'          : Only load JavaScript from same origin
    # - style-src 'self'           : Only load CSS from same origin
    # - img-src 'self' data:       : Images from same origin + data URIs (base64)
    # - connect-src 'self'         : AJAX/fetch only to same origin
    # - object-src 'none'          : Block plugins (Flash, Java, etc.)
    # - base-uri 'self'            : Restrict <base> tag to same origin
    # - form-action 'self'         : Forms can only submit to same origin
    #
    # Note: No 'unsafe-inline' or 'unsafe-eval' - all code externalized!
    # ----------------------------------------------------------------------------
    add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';" always;
    
    # ----------------------------------------------------------------------------
    # X-Frame-Options
    # ----------------------------------------------------------------------------
    # Prevents clickjacking attacks by controlling iframe embedding.
    # DENY = Cannot be embedded in any iframe (most secure)
    # SAMEORIGIN = Can only be embedded in iframes from same origin
    #
    # Use DENY unless you need iframe embedding from same origin.
    # ----------------------------------------------------------------------------
    add_header X-Frame-Options "DENY" always;
    
    # ----------------------------------------------------------------------------
    # X-Content-Type-Options
    # ----------------------------------------------------------------------------
    # Prevents MIME-type sniffing attacks.
    # Forces browsers to respect declared Content-Type headers.
    # Prevents browsers from interpreting files as different types.
    # ----------------------------------------------------------------------------
    add_header X-Content-Type-Options "nosniff" always;
    
    # ----------------------------------------------------------------------------
    # Referrer-Policy
    # ----------------------------------------------------------------------------
    # Controls how much referrer information is sent with requests.
    # strict-origin-when-cross-origin:
    # - Same-origin requests: Full URL sent as referrer
    # - Cross-origin HTTPS→HTTPS: Only origin sent (no path)
    # - Cross-origin HTTPS→HTTP: No referrer sent (downgrade protection)
    #
    # Protects against URL parameter leakage to external sites.
    # ----------------------------------------------------------------------------
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # ----------------------------------------------------------------------------
    # Permissions-Policy (formerly Feature-Policy)
    # ----------------------------------------------------------------------------
    # Controls which browser features and APIs can be used.
    # Disabled features: geolocation, microphone, camera, payment APIs
    # This prevents malicious code from accessing sensitive device features.
    #
    # Additional options you can restrict:
    # - accelerometer, gyroscope, magnetometer (motion sensors)
    # - fullscreen, picture-in-picture (display modes)
    # - usb, serial, bluetooth (hardware access)
    # ----------------------------------------------------------------------------
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()" always;
    
    # ----------------------------------------------------------------------------
    # Strict-Transport-Security (HSTS)
    # ----------------------------------------------------------------------------
    # Forces browsers to only connect via HTTPS for specified duration.
    # ONLY enable this if you serve the application over HTTPS!
    #
    # Parameters:
    # - max-age=31536000       : Enforce HTTPS for 1 year (in seconds)
    # - includeSubDomains      : Apply to all subdomains
    # - preload                : Allow submission to HSTS preload list
    #
    # WARNING: Do NOT enable if you serve over HTTP or if HTTPS is not
    #          properly configured - this will break your application!
    #
    # Uncomment the following line after HTTPS is configured:
    # ----------------------------------------------------------------------------
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    
    # ----------------------------------------------------------------------------
    # Additional Security Headers
    # ----------------------------------------------------------------------------
    # Remove server signature to hide Nginx version information
    # ----------------------------------------------------------------------------
    server_tokens off;
    
    # Remove any X-Powered-By headers that might leak technology stack
    more_clear_headers 'X-Powered-By';  # Requires ngx_headers_more module
    
    # ----------------------------------------------------------------------------
    # Location Block for Static Files
    # ----------------------------------------------------------------------------
    location / {
        try_files $uri $uri/ =404;
    }
    
    # ----------------------------------------------------------------------------
    # Cache Control for Static Assets
    # ----------------------------------------------------------------------------
    # CSS and JavaScript files
    location ~* \.(css|js)$ {
        expires 1d;
        add_header Cache-Control "public, immutable";
        
        # Re-apply security headers in location block
        add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';" always;
        add_header X-Frame-Options "DENY" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()" always;
    }
    
    # JSON configuration files
    location ~* \.json$ {
        add_header Content-Type application/json;
        expires 1h;
        
        # Re-apply security headers in location block
        add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';" always;
        add_header X-Frame-Options "DENY" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()" always;
    }
    
    # ----------------------------------------------------------------------------
    # Disable Access to Hidden Files and Directories
    # ----------------------------------------------------------------------------
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # ----------------------------------------------------------------------------
    # Disable Access to Backup Files
    # ----------------------------------------------------------------------------
    location ~ ~$ {
        deny all;
        access_log off;
        log_not_found off;
    }
}

# ============================================================================
# HTTPS Server Block (Optional - Enable after SSL configuration)
# ============================================================================
# Uncomment and configure after obtaining SSL certificates
# (e.g., from Let's Encrypt: certbot --nginx -d sebconfig.example.com)
# ============================================================================

# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     server_name sebconfig.example.com;
#     
#     root /var/www/sebconfig;
#     index index.html;
#     
#     # SSL Certificate Configuration
#     ssl_certificate /etc/letsencrypt/live/sebconfig.example.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/sebconfig.example.com/privkey.pem;
#     
#     # SSL Security Configuration (Mozilla Intermediate)
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
#     ssl_prefer_server_ciphers off;
#     ssl_session_timeout 1d;
#     ssl_session_cache shared:SSL:50m;
#     ssl_session_tickets off;
#     
#     # OCSP Stapling
#     ssl_stapling on;
#     ssl_stapling_verify on;
#     ssl_trusted_certificate /etc/letsencrypt/live/sebconfig.example.com/chain.pem;
#     
#     # Security Headers (HSTS enabled)
#     add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';" always;
#     add_header X-Frame-Options "DENY" always;
#     add_header X-Content-Type-Options "nosniff" always;
#     add_header Referrer-Policy "strict-origin-when-cross-origin" always;
#     add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()" always;
#     add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
#     
#     server_tokens off;
#     
#     # Rest of configuration same as HTTP block above...
# }

# ============================================================================
# End of Nginx Configuration
# ============================================================================
# Installation Instructions:
# 1. Copy this file to /etc/nginx/sites-available/sebconfig
# 2. Edit server_name and root path
# 3. Create symlink: ln -s /etc/nginx/sites-available/sebconfig /etc/nginx/sites-enabled/
# 4. Test configuration: nginx -t
# 5. Reload Nginx: systemctl reload nginx
#
# Testing Instructions:
# 1. Access your application via browser
# 2. Open Developer Tools > Network tab
# 3. Reload page and check Response Headers
# 4. Verify all security headers are present
#
# Online Testing Tools:
# - https://securityheaders.com/
# - https://observatory.mozilla.org/
# ============================================================================
